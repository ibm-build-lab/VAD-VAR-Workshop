!function(){var e,t,n,s,r={2798:function(e,t,n){"use strict";var s=n(3308);Object.assign(s.OBj,{...s.OBj,allowLocalModels:!1,allowRemoteModels:!0,useBrowserCache:!1,useFSCache:!1,useCustomCache:!1});const r="google/flan-t5-small";let i=function(){function e(){}return e.getInstance=async function(t,n){return void 0===t&&(t=r),e.instance&&t===e.model||(console.log("Updating tokenizer instance",t),e.instance=await s.t25.from_pretrained(t,{...n,local_files_only:!1}),e.model=t),e.instance},e}();i.model=r,self.addEventListener("message",(async e=>{const{model:t=r,text:n}=e.data,s=await i.getInstance(t,{progress_callback:e=>self.postMessage({status:"not-complete",output:e})}),o=s.encode(n),a=o.map((e=>s.decode_single([e],{skip_special_tokens:!0,clean_up_tokenization_spaces:!0}))).filter((e=>e));self.postMessage({status:"complete",output:{tokenStrings:a,tokenIds:o}})}))},8412:function(e,t,n){"use strict";n.r(t),n.d(t,{InferenceSession:function(){return p},Tensor:function(){return d},env:function(){return o},registerBackend:function(){return i}});const s={},r=[],i=(e,t,n)=>{if(!t||"function"!=typeof t.init||"function"!=typeof t.createSessionHandler)throw new TypeError("not a valid backend");{const i=s[e];if(void 0===i)s[e]={backend:t,priority:n};else{if(i.priority>n)return;if(i.priority===n&&i.backend!==t)throw new Error(`cannot register backend "${e}" using priority ${n}`)}if(n>=0){const t=r.indexOf(e);-1!==t&&r.splice(t,1);for(let i=0;i<r.length;i++)if(s[r[i]].priority<=n)return void r.splice(i,0,e);r.push(e)}}};const o=new class{constructor(){this.wasm={},this.webgl={},this.logLevelInternal="warning"}set logLevel(e){if(void 0!==e){if("string"!=typeof e||-1===["verbose","info","warning","error","fatal"].indexOf(e))throw new Error(`Unsupported logging level: ${e}`);this.logLevelInternal=e}}get logLevel(){return this.logLevelInternal}},a="undefined"!=typeof BigInt64Array&&"function"==typeof BigInt64Array.from,l="undefined"!=typeof BigUint64Array&&"function"==typeof BigUint64Array.from,h=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array]]),c=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);a&&(h.set("int64",BigInt64Array),c.set(BigInt64Array,"int64")),l&&(h.set("uint64",BigUint64Array),c.set(BigUint64Array,"uint64"));class u{constructor(e,t,n){let s,r,i;if("string"==typeof e)if(s=e,i=n,"string"===e){if(!Array.isArray(t))throw new TypeError("A string tensor's data must be a string array.");r=t}else{const n=h.get(e);if(void 0===n)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t))r=n.from(t);else{if(!(t instanceof n))throw new TypeError(`A ${s} tensor's data must be type of ${n}`);r=t}}else if(i=t,Array.isArray(e)){if(0===e.length)throw new TypeError("Tensor type cannot be inferred from an empty array.");const t=typeof e[0];if("string"===t)s="string",r=e;else{if("boolean"!==t)throw new TypeError(`Invalid element type of data array: ${t}.`);s="bool",r=Uint8Array.from(e)}}else{const t=c.get(e.constructor);if(void 0===t)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);s=t,r=e}if(void 0===i)i=[r.length];else if(!Array.isArray(i))throw new TypeError("A tensor's dims must be a number array");const o=(e=>{let t=1;for(let n=0;n<e.length;n++){const s=e[n];if("number"!=typeof s||!Number.isSafeInteger(s))throw new TypeError(`dims[${n}] must be an integer, got: ${s}`);if(s<0)throw new RangeError(`dims[${n}] must be a non-negative integer, got: ${s}`);t*=s}return t})(i);if(o!==r.length)throw new Error(`Tensor's size(${o}) does not match data length(${r.length}).`);this.dims=i,this.type=s,this.data=r,this.size=o}static bufferToTensor(e,t){if(void 0===e)throw new Error("Image buffer must be defined");if(void 0===t.height||void 0===t.width)throw new Error("Image height and width must be defined");const{height:n,width:s}=t,r=t.norm;let i,o;i=void 0===r||void 0===r.mean?255:r.mean,o=void 0===r||void 0===r.bias?0:r.bias;const a=void 0!==t.bitmapFormat?t.bitmapFormat:"RGBA",l=void 0!==t.tensorFormat&&void 0!==t.tensorFormat?t.tensorFormat:"RGB",h=n*s,c="RGBA"===l?new Float32Array(4*h):new Float32Array(3*h);let d=4,f=0,p=1,_=2,g=3,m=0,w=h,y=2*h,b=-1;"RGB"===a&&(d=3,f=0,p=1,_=2,g=-1),"RGBA"===l?b=3*h:"RBG"===l?(m=0,y=h,w=2*h):"BGR"===l&&(y=0,w=h,m=2*h);for(let u=0;u<h;u++,f+=d,_+=d,p+=d,g+=d)c[m++]=(e[f]+o)/i,c[w++]=(e[p]+o)/i,c[y++]=(e[_]+o)/i,-1!==b&&-1!==g&&(c[b++]=(e[g]+o)/i);return new u("float32",c,"RGBA"===l?[1,4,n,s]:[1,3,n,s])}static async fromImage(e,t){const n="undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement,s="undefined"!=typeof ImageData&&e instanceof ImageData,r="undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap,i="undefined"!=typeof String&&(e instanceof String||"string"==typeof e);let o,a={};if(n){const n=document.createElement("canvas"),s=n.getContext("2d");if(null==s)throw new Error("Can not access image data");{let r=e.naturalHeight,i=e.naturalWidth;if(void 0!==t&&void 0!==t.resizedHeight&&void 0!==t.resizedWidth&&(r=t.resizedHeight,i=t.resizedWidth),void 0!==t){if(a=t,void 0!==t.tensorFormat)throw new Error("Image input config format must be RGBA for HTMLImageElement");if(a.tensorFormat="RGBA",void 0!==t.height&&t.height!==r)throw new Error("Image input config height doesn't match HTMLImageElement height");if(a.height=r,void 0!==t.width&&t.width!==i)throw new Error("Image input config width doesn't match HTMLImageElement width");a.width=i}else a.tensorFormat="RGBA",a.height=r,a.width=i;n.width=i,n.height=r,s.drawImage(e,0,0,i,r),o=s.getImageData(0,0,i,r).data}}else{if(!s){if(r){if(void 0===t)throw new Error("Please provide image config with format for Imagebitmap");if(void 0!==t.bitmapFormat)throw new Error("Image input config format must be defined for ImageBitmap");const n=document.createElement("canvas").getContext("2d");if(null!=n){const s=e.height,r=e.width;if(n.drawImage(e,0,0,r,s),o=n.getImageData(0,0,r,s).data,void 0!==t){if(void 0!==t.height&&t.height!==s)throw new Error("Image input config height doesn't match ImageBitmap height");if(a.height=s,void 0!==t.width&&t.width!==r)throw new Error("Image input config width doesn't match ImageBitmap width");a.width=r}else a.height=s,a.width=r;return u.bufferToTensor(o,a)}throw new Error("Can not access image data")}if(i)return new Promise(((n,s)=>{const r=document.createElement("canvas"),i=r.getContext("2d");if(!e||!i)return s();const o=new Image;o.crossOrigin="Anonymous",o.src=e,o.onload=()=>{r.width=o.width,r.height=o.height,i.drawImage(o,0,0,r.width,r.height);const e=i.getImageData(0,0,r.width,r.height);if(void 0!==t){if(void 0!==t.height&&t.height!==r.height)throw new Error("Image input config height doesn't match ImageBitmap height");if(a.height=r.height,void 0!==t.width&&t.width!==r.width)throw new Error("Image input config width doesn't match ImageBitmap width");a.width=r.width}else a.height=r.height,a.width=r.width;n(u.bufferToTensor(e.data,a))}}));throw new Error("Input data provided is not supported - aborted tensor creation")}{const n="RGBA";let s,r;if(void 0!==t&&void 0!==t.resizedWidth&&void 0!==t.resizedHeight?(s=t.resizedHeight,r=t.resizedWidth):(s=e.height,r=e.width),void 0!==t){if(a=t,void 0!==t.bitmapFormat&&t.bitmapFormat!==n)throw new Error("Image input config format must be RGBA for ImageData");a.bitmapFormat="RGBA"}else a.bitmapFormat="RGBA";if(a.height=s,a.width=r,void 0!==t){const t=document.createElement("canvas");t.width=r,t.height=s;const n=t.getContext("2d");if(null==n)throw new Error("Can not access image data");n.putImageData(e,0,0),o=n.getImageData(0,0,r,s).data}else o=e.data}}if(void 0!==o)return u.bufferToTensor(o,a);throw new Error("Input data provided is not supported - aborted tensor creation")}toImageData(e){var t,n;const s=document.createElement("canvas").getContext("2d");let r;if(null==s)throw new Error("Can not access image data");{const i=this.dims[3],o=this.dims[2],a=this.dims[1],l=void 0!==e&&void 0!==e.format?e.format:"RGB",h=void 0!==e&&void 0!==(null===(t=e.norm)||void 0===t?void 0:t.mean)?e.norm.mean:255,c=void 0!==e&&void 0!==(null===(n=e.norm)||void 0===n?void 0:n.bias)?e.norm.bias:0,u=o*i;if(void 0!==e){if(void 0!==e.height&&e.height!==o)throw new Error("Image output config height doesn't match tensor height");if(void 0!==e.width&&e.width!==i)throw new Error("Image output config width doesn't match tensor width");if(void 0!==e.format&&4===a&&"RGBA"!==e.format||3===a&&"RGB"!==e.format&&"BGR"!==e.format)throw new Error("Tensor format doesn't match input tensor dims")}const d=4;let f=0,p=1,_=2,g=3,m=0,w=u,y=2*u,b=-1;"RGBA"===l?(m=0,w=u,y=2*u,b=3*u):"RGB"===l?(m=0,w=u,y=2*u):"RBG"===l&&(m=0,y=u,w=2*u),r=s.createImageData(i,o);for(let e=0;e<o*i;f+=d,p+=d,_+=d,g+=d,e++)r.data[f]=(this.data[m++]-c)*h,r.data[p]=(this.data[w++]-c)*h,r.data[_]=(this.data[y++]-c)*h,r.data[g]=-1===b?255:(this.data[b++]-c)*h}return r}reshape(e){return new u(this.type,this.data,e)}}const d=u;class f{constructor(e){this.handler=e}async run(e,t,n){const s={};let r={};if("object"!=typeof e||null===e||e instanceof d||Array.isArray(e))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let i=!0;if("object"==typeof t){if(null===t)throw new TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof d)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(t)){if(0===t.length)throw new TypeError("'fetches' cannot be an empty array.");i=!1;for(const e of t){if("string"!=typeof e)throw new TypeError("'fetches' must be a string array or an object.");if(-1===this.outputNames.indexOf(e))throw new RangeError(`'fetches' contains invalid output name: ${e}.`);s[e]=null}if("object"==typeof n&&null!==n)r=n;else if(void 0!==n)throw new TypeError("'options' must be an object.")}else{let e=!1;const o=Object.getOwnPropertyNames(t);for(const n of this.outputNames)if(-1!==o.indexOf(n)){const r=t[n];(null===r||r instanceof d)&&(e=!0,i=!1,s[n]=r)}if(e){if("object"==typeof n&&null!==n)r=n;else if(void 0!==n)throw new TypeError("'options' must be an object.")}else r=t}}else if(void 0!==t)throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(const l of this.inputNames)if(void 0===e[l])throw new Error(`input '${l}' is missing in 'feeds'.`);if(i)for(const l of this.outputNames)s[l]=null;const o=await this.handler.run(e,s,r),a={};for(const l in o)Object.hasOwnProperty.call(o,l)&&(a[l]=new d(o[l].type,o[l].data,o[l].dims));return a}static async create(e,t,n,i){let o,a={};if("string"==typeof e){if(o=e,"object"==typeof t&&null!==t)a=t;else if(void 0!==t)throw new TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(o=e,"object"==typeof t&&null!==t)a=t;else if(void 0!==t)throw new TypeError("'options' must be an object.")}else{if(!(e instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer))throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");{const s=e;let r=0,l=e.byteLength;if("object"==typeof t&&null!==t)a=t;else if("number"==typeof t){if(r=t,!Number.isSafeInteger(r))throw new RangeError("'byteOffset' must be an integer.");if(r<0||r>=s.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${s.byteLength}).`);if(l=e.byteLength-r,"number"==typeof n){if(l=n,!Number.isSafeInteger(l))throw new RangeError("'byteLength' must be an integer.");if(l<=0||r+l>s.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${s.byteLength-r}].`);if("object"==typeof i&&null!==i)a=i;else if(void 0!==i)throw new TypeError("'options' must be an object.")}else if(void 0!==n)throw new TypeError("'byteLength' must be a number.")}else if(void 0!==t)throw new TypeError("'options' must be an object.");o=new Uint8Array(s,r,l)}}const l=(a.executionProviders||[]).map((e=>"string"==typeof e?e:e.name)),h=await(async e=>{const t=0===e.length?r:e,n=[];for(const r of t){const e=s[r];if(e){if(e.initialized)return e.backend;if(e.aborted)continue;const t=!!e.initPromise;try{return t||(e.initPromise=e.backend.init()),await e.initPromise,e.initialized=!0,e.backend}catch(i){t||n.push({name:r,err:i}),e.aborted=!0}finally{delete e.initPromise}}}throw new Error(`no available backend found. ERR: ${n.map((e=>`[${e.name}] ${e.err}`)).join(", ")}`)})(l),c=await h.createSessionHandler(o,a);return new f(c)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}const p=f},495:function(){},7147:function(){},1418:function(){},8741:function(){},319:function(){},8386:function(){},3342:function(){},5926:function(){},1328:function(e,t,n){"use strict";var s,r;n.d(t,{ONNX:function(){return a},p:function(){return l}});var i=n(495),o=n(8736);let a;const l=["wasm"];if("undefined"!=typeof process&&"node"===process?.release?.name)a=i??(s||(s=n.t(i,2))),l.unshift("cpu");else{a=o??(r||(r=n.t(o,2)));"undefined"!=typeof navigator&&/iP(hone|od|ad).+16_4.+AppleWebKit/.test(navigator.userAgent)&&(a.env.wasm.simd=!1)}},3675:function(e,t,n){"use strict";n.d(t,{z:function(){return i}});var s=n(5261);class r{constructor(e){this.model_type=null,this.is_encoder_decoder=!1,Object.assign(this,e)}static async from_pretrained(e,{progress_callback:t=null,config:n=null,cache_dir:r=null,local_files_only:i=!1,revision:o="main"}={}){let a=n??await async function(e,t){return await(0,s.yM)(e,"config.json",!0,t)}(e,{progress_callback:t,config:n,cache_dir:r,local_files_only:i,revision:o});return new this(a)}}class i{static async from_pretrained(...e){return r.from_pretrained(...e)}}},8563:function(e,t,n){"use strict";n.d(t,{O:function(){return m}});var s=n(8386),r=n(3342),i=n(5926),o=n(1328);const{env:a}=o.ONNX,l="2.7.0",h="undefined"!=typeof self&&"caches"in self,c=!w(s),u=!w(r),d=c&&u,f=d?r.dirname(r.dirname(i.fileURLToPath("file:///home/runner/work/VAD-VAR-Workshop/VAD-VAR-Workshop/node_modules/@xenova/transformers/src/env.js"))):"./",p=d?r.join(f,"/.cache/"):null,_="/models/",g=d?r.join(f,_):_;a.wasm.wasmPaths=d?r.join(f,"/dist/"):`https://cdn.jsdelivr.net/npm/@xenova/transformers@${l}/dist/`;const m={backends:{onnx:a,tfjs:{}},__dirname:f,version:l,allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!0,localModelPath:g,useFS:c,useBrowserCache:h,useFSCache:c,cacheDir:p,useCustomCache:!1,customCache:null};function w(e){return 0===Object.keys(e).length}},3308:function(e,t,n){"use strict";n.d(t,{t25:function(){return Xe},OBj:function(){return Ve.O},qCb:function(){return i.qC}});var s=n(9346),r=n(5261),i=n(1912),o=n(4e3);class a{constructor(e=((e,t)=>e>t)){this._heap=[],this._comparator=e}get size(){return this._heap.length}isEmpty(){return 0===this.size}peek(){return this._heap[0]}push(...e){return this.extend(e)}extend(e){for(const t of e)this._heap.push(t),this._siftUp();return this.size}pop(){const e=this.peek(),t=this.size-1;return t>0&&this._swap(0,t),this._heap.pop(),this._siftDown(),e}replace(e){const t=this.peek();return this._heap[0]=e,this._siftDown(),t}_parent(e){return(e+1>>>1)-1}_left(e){return 1+(e<<1)}_right(e){return e+1<<1}_greater(e,t){return this._comparator(this._heap[e],this._heap[t])}_swap(e,t){const n=this._heap[e];this._heap[e]=this._heap[t],this._heap[t]=n}_siftUp(){let e=this.size-1;for(;e>0&&this._greater(e,this._parent(e));)this._swap(e,this._parent(e)),e=this._parent(e)}_siftDown(){let e=0;for(;this._left(e)<this.size&&this._greater(this._left(e),e)||this._right(e)<this.size&&this._greater(this._right(e),e);){const t=this._right(e)<this.size&&this._greater(this._right(e),this._left(e))?this._right(e):this._left(e);this._swap(e,t),e=t}}}class l{constructor(){this.root=h.default()}extend(e){for(let t of e)this.push(t)}push(e){let t=this.root;for(let n of e){let e=t.children.get(n);void 0===e&&(e=h.default(),t.children.set(n,e)),t=e}t.isLeaf=!0}*commonPrefixSearch(e){let t=this.root,n="";for(let s=0;s<e.length&&void 0!==t;++s){const r=e[s];n+=r,t=t.children.get(r),void 0!==t&&t.isLeaf&&(yield n)}}}class h{constructor(e,t){this.isLeaf=e,this.children=t}static default(){return new h(!1,new Map)}}class c{constructor(e,t,n){this.sentence=e,this.len=e.length,this.bosTokenId=t,this.eosTokenId=n,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},(()=>[])),this.endNodes=Array.from({length:this.len+1},(()=>[]));const s=new u(this.bosTokenId,0,0,0,0),r=new u(this.eosTokenId,1,this.len,0,0);this.nodes.push(s.clone()),this.nodes.push(r.clone()),this.beginNodes[this.len].push(r),this.endNodes[0].push(s)}insert(e,t,n,s){const r=this.nodes.length,i=new u(s,r,e,t,n);this.beginNodes[e].push(i),this.endNodes[e+t].push(i),this.nodes.push(i)}viterbi(){const e=this.len;let t=0;for(;t<=e;){if(0==this.beginNodes[t].length)return[];for(let e of this.beginNodes[t]){e.prev=null;let n=0,s=null;for(let r of this.endNodes[t]){const t=r.backtraceScore+e.score;(null===s||t>n)&&(s=r.clone(),n=t)}if(null===s)return[];e.prev=s,e.backtraceScore=n}++t}const n=[],s=this.beginNodes[e][0].prev;if(null===s)return[];let r=s.clone();for(;null!==r.prev;){n.push(r.clone());const e=r.clone();r=e.prev.clone()}return n.reverse(),n}piece(e){return this.sentence.slice(e.pos,e.pos+e.length)}tokens(){return this.viterbi().map((e=>this.piece(e)))}tokenIds(){return this.viterbi().map((e=>e.tokenId))}}class u{constructor(e,t,n,s,r){this.tokenId=e,this.nodeId=t,this.pos=n,this.length=s,this.score=r,this.prev=null,this.backtraceScore=0}clone(){const e=new u(this.tokenId,this.nodeId,this.pos,this.length,this.score);return e.prev=this.prev,e.backtraceScore=this.backtraceScore,e}}async function d(e,t){return await Promise.all([(0,r.yM)(e,"tokenizer.json",!0,t),(0,r.yM)(e,"tokenizer_config.json",!0,t)])}function f(e,t=!0){return void 0!==e.Regex?new RegExp(t?e.Regex:`(${e.Regex})`,"gu"):void 0!==e.String?e.String:(console.warn("Unknown pattern type:",e),null)}function p(e){return new Map(Object.entries(e))}function _(e){return e.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function g(e){return e.replace(/[\u0300-\u036f]/g,"")}const m="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E";class w extends s.Ag{constructor(e){super(),this.config=e,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=this.config.fuse_unk??!1}static fromConfig(e,...t){switch(e.type){case"WordPiece":return new y(e);case"Unigram":return new b(e,...t);case"BPE":return new v(e);default:if(e.vocab)return new A(e,...t);throw new Error(`Unknown TokenizerModel type: ${e.type}`)}}_call(e){return this.encode(e)}encode(e){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(e){let t=e.map((e=>this.tokens_to_ids.get(e)??this.unk_token_id));return this.fuse_unk&&(t=function(e,t){let n=[],s=0;for(;s<e.length;)if(n.push(e[s]),e[s]===t)for(;s<e.length&&e[s]===t;)++s;else++s;return n}(t,this.unk_token_id)),t}convert_ids_to_tokens(e){return e.map((e=>this.vocab[e]??this.unk_token))}}class y extends w{constructor(e){super(e),this.tokens_to_ids=p(e.vocab),this.unk_token_id=this.tokens_to_ids.get(e.unk_token),this.unk_token=e.unk_token,this.vocab=new Array(this.tokens_to_ids.size);for(const[t,n]of this.tokens_to_ids)this.vocab[n]=t}encode(e){let t=[];for(let n of e){let e=[...n],s=!1,r=0,i=[];for(;r<e.length;){let t=e.length,n=null;for(;r<t;){let s=e.slice(r,t).join("");if(r>0&&(s=this.config.continuing_subword_prefix+s),this.tokens_to_ids.has(s)){n=s;break}--t}if(null===n){s=!0;break}i.push(n),r=t}s?t.push(this.unk_token):t.push(...i)}return t}}class b extends w{constructor(e,t){super(e);const n=e.vocab.length;this.vocab=new Array(n),this.scores=new Array(n);for(let s=0;s<n;++s){const t=e.vocab[s];this.vocab[s]=t[0],this.scores[s]=t[1]}this.unk_token_id=e.unk_id,this.unk_token=this.vocab[e.unk_id],this.tokens_to_ids=new Map(this.vocab.map(((e,t)=>[e,t]))),this.bosToken=" ",this.bosTokenId=this.tokens_to_ids.get(this.bosToken),this.eosToken=t.eos_token,this.eosTokenId=this.tokens_to_ids.get(this.eosToken),this.unkToken=this.vocab[this.unk_token_id],this.minScore=(0,i.VV)(this.scores)[0],this.unkScore=this.minScore-10,this.scores[this.unk_token_id]=this.unkScore,this.trie=new l,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(e){const t=e.sentence,n=t.length;let s=0;for(;s<n;){const n=1;let r=!1;const i=[];for(let o of this.trie.commonPrefixSearch(t.slice(s))){i.push(o);const t=this.tokens_to_ids.get(o),a=this.scores[t],l=o.length;e.insert(s,l,a,t),r||l!==n||(r=!0)}r||e.insert(s,n,this.unkScore,this.unk_token_id),s+=n}}tokenize(e){const t=new c(e,this.bosTokenId,this.eosTokenId);return this.populateNodes(t),t.tokens()}encode(e){let t=[];for(let n of e){const e=this.tokenize(n);t.push(...e)}return t}}const k=(()=>{const e=[...Array.from({length:"~".charCodeAt(0)-"!".charCodeAt(0)+1},((e,t)=>t+"!".charCodeAt(0))),...Array.from({length:"¬".charCodeAt(0)-"¡".charCodeAt(0)+1},((e,t)=>t+"¡".charCodeAt(0))),...Array.from({length:"ÿ".charCodeAt(0)-"®".charCodeAt(0)+1},((e,t)=>t+"®".charCodeAt(0)))];let t=e.slice(),n=0;for(let r=0;r<256;++r)e.includes(r)||(e.push(r),t.push(256+n),n+=1);let s=t.map((e=>String.fromCharCode(e)));return Object.fromEntries(e.map(((e,t)=>[e,s[t]])))})(),x=(0,s.$2)(k);class v extends w{constructor(e){super(e),this.BPE_SPLIT_TOKEN=" ",this.tokens_to_ids=p(e.vocab),this.unk_token_id=this.tokens_to_ids.get(e.unk_token),this.unk_token=e.unk_token,this.vocab=new Array(this.tokens_to_ids.size);for(const[t,n]of this.tokens_to_ids)this.vocab[n]=t;this.bpe_ranks=new Map(e.merges.map(((e,t)=>[e,t]))),this.merges=e.merges.map((e=>e.split(this.BPE_SPLIT_TOKEN))),this.end_of_word_suffix=e.end_of_word_suffix,this.continuing_subword_suffix=e.continuing_subword_suffix??null,this.byte_fallback=this.config.byte_fallback??!1,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.cache=new Map}bpe(e){if(0===e.length)return[];const t=this.cache.get(e);if(void 0!==t)return t;const n=Array.from(e);this.end_of_word_suffix&&(n[n.length-1]+=this.end_of_word_suffix);let s=[];if(n.length>1){const e=new a(((e,t)=>e.score<t.score));let t={token:n[0],bias:0,prev:null,next:null},r=t;for(let s=1;s<n.length;++s){const t={bias:s/n.length,token:n[s],prev:r,next:null};r.next=t,this._add_node(e,r),r=t}for(;!e.isEmpty();){const n=e.pop();if(n.deleted||!n.next||n.next.deleted)continue;if(n.deleted=!0,n.next.deleted=!0,n.prev){const e={...n.prev};n.prev.deleted=!0,n.prev=e,e.prev?e.prev.next=e:t=e}const s={token:n.token+n.next.token,bias:n.bias,prev:n.prev,next:n.next.next};s.prev?(s.prev.next=s,this._add_node(e,s.prev)):t=s,s.next&&(s.next.prev=s,this._add_node(e,s))}for(let n=t;null!==n;n=n.next)s.push(n.token)}else s=n;if(this.continuing_subword_suffix)for(let r=0;r<s.length-1;++r)s[r]+=this.continuing_subword_suffix;return this.cache.set(e,s),s}_add_node(e,t){const n=this.bpe_ranks.get(t.token+this.BPE_SPLIT_TOKEN+t.next.token);void 0!==n&&(t.score=n+t.bias,e.push(t))}encode(e){let t=[];for(let n of e){let e=this.bpe(n);for(let n of e)this.tokens_to_ids.has(n)?t.push(n):this.byte_fallback?t.push(...Array.from(this.text_encoder.encode(n)).map((e=>`<0x${e.toString(16).toUpperCase().padStart(2,"0")}>`))):t.push(this.unk_token)}return t}}class A extends w{constructor(e,t){super(e),this.tokens_to_ids=p(t.target_lang?e.vocab[t.target_lang]:e.vocab),this.bos_token=t.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=t.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=t.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=t.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=new Array(this.tokens_to_ids.size);for(const[n,s]of this.tokens_to_ids)this.vocab[s]=n}encode(e){return e}}class z extends s.Ag{constructor(e){super(),this.config=e}static fromConfig(e){if(null===e)return null;switch(e.type){case"BertNormalizer":return new O(e);case"Precompiled":return new re(e);case"Sequence":return new R(e);case"Replace":return new E(e);case"NFC":return new T(e);case"NFKD":return new M(e);case"Strip":return new C(e);case"StripAccents":return new I(e);case"Lowercase":return new S(e);case"Prepend":return new F(e);default:throw new Error(`Unknown Normalizer type: ${e.type}`)}}normalize(e){throw Error("normalize should be implemented in subclass.")}_call(e){return this.normalize(e)}}class E extends z{normalize(e){let t=f(this.config.pattern);return null===t?e:e=e.replaceAll(t,this.config.content)}}class T extends z{normalize(e){return e=e.normalize("NFC")}}class M extends z{normalize(e){return e=e.normalize("NFKD")}}class C extends z{normalize(e){return this.config.strip_left&&this.config.strip_right?e=e.trim():(this.config.strip_left&&(e=e.trimStart()),this.config.strip_right&&(e=e.trimEnd())),e}}class I extends z{normalize(e){return e=g(e)}}class S extends z{normalize(e){return e=e.toLowerCase()}}class F extends z{normalize(e){return e=this.config.prepend+e}}class R extends z{constructor(e){super(e),this.normalizers=e.normalizers.map((e=>z.fromConfig(e)))}normalize(e){return this.normalizers.reduce(((e,t)=>t.normalize(e)),e)}}class O extends z{_tokenize_chinese_chars(e){let t=[];for(let n=0;n<e.length;++n){let s=e[n],r=s.charCodeAt(0);this._is_chinese_char(r)?(t.push(" "),t.push(s),t.push(" ")):t.push(s)}return t.join("")}_is_chinese_char(e){return e>=19968&&e<=40959||e>=13312&&e<=19903||e>=131072&&e<=173791||e>=173824&&e<=177983||e>=177984&&e<=178207||e>=178208&&e<=183983||e>=63744&&e<=64255||e>=194560&&e<=195103}stripAccents(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}normalize(e){return this.config.handle_chinese_chars&&(e=this._tokenize_chinese_chars(e)),this.config.lowercase?(e=e.toLowerCase(),!1!==this.config.strip_accents&&(e=this.stripAccents(e))):this.config.strip_accents&&(e=this.stripAccents(e)),e}}class j extends s.Ag{static fromConfig(e){if(null===e)return null;switch(e.type){case"BertPreTokenizer":return new $(e);case"Sequence":return new ie(e);case"WhitespaceSplit":return new oe(e);case"Metaspace":return new ne(e);case"ByteLevel":return new P(e);case"Split":return new N(e);case"Punctuation":return new B(e);case"Digits":return new U(e);case"Replace":return new ae(e);default:throw new Error(`Unknown PreTokenizer type: ${e.type}`)}}pre_tokenize_text(e){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(e){let t=[];return t=Array.isArray(e)?e.map((e=>this.pre_tokenize_text(e))):this.pre_tokenize_text(e),t.flat()}_call(e){return this.pre_tokenize(e)}}class $ extends j{constructor(e){super(),this.pattern=new RegExp(`[^\\s${m}]+|[${m}]`,"gu")}pre_tokenize_text(e){return e.trim().match(this.pattern)||[]}}class P extends j{constructor(e){super(),this.config=e,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=this.config.use_regex??!0,this.pattern=/'s|'t|'re|'ve|'m|'ll|'d| ?\p{L}+| ?\p{N}+| ?[^\s\p{L}\p{N}]+|\s+(?!\S)|\s+/gu,this.byte_encoder=k,this.text_encoder=new TextEncoder}pre_tokenize_text(e){return this.add_prefix_space&&!e.startsWith(" ")&&(e=" "+e),(this.use_regex?e.match(this.pattern)||[]:[e]).map((e=>Array.from(this.text_encoder.encode(e),(e=>this.byte_encoder[e])).join("")))}}class N extends j{constructor(e){super(),this.config=e,this.pattern=f(this.config.pattern,this.config.invert)}pre_tokenize_text(e){return null===this.pattern?[]:this.config.invert?e.match(this.pattern)||[]:e.split(this.pattern).filter((e=>e))}}class B extends j{constructor(e){super(),this.config=e,this.pattern=new RegExp(`[^${m}]+|[${m}]+`,"gu")}pre_tokenize_text(e){return e.match(this.pattern)||[]}}class U extends j{constructor(e){super(),this.config=e;const t="[^\\d]+|\\d"+(this.config.individual_digits?"":"+");this.pattern=new RegExp(t,"gu")}pre_tokenize_text(e){return e.match(this.pattern)||[]}}class L extends s.Ag{constructor(e){super(),this.config=e}static fromConfig(e){if(null===e)return null;switch(e.type){case"TemplateProcessing":return new W(e);case"ByteLevel":return new q(e);case"RobertaProcessing":return new D(e);case"BertProcessing":return new G(e);default:throw new Error(`Unknown PostProcessor type: ${e.type}`)}}post_process(e,...t){throw Error("post_process should be implemented in subclass.")}_call(e,...t){return this.post_process(e,...t)}}class G extends L{constructor(e){super(e),this.cls=e.cls[0],this.sep=e.sep[0]}post_process(e,t=null){return e=(0,s.eG)([this.cls],e,[this.sep]),null!==t&&(e=(0,s.eG)(e,[this.sep],t,[this.sep])),e}}class D extends G{}class W extends L{constructor(e){super(e),this.single=e.single,this.pair=e.pair}post_process(e,t=null){let n=null===t?this.single:this.pair,r=[];for(let i of n)"SpecialToken"in i?r.push(i.SpecialToken.id):"Sequence"in i&&("A"===i.Sequence.id?r=(0,s.eG)(r,e):"B"===i.Sequence.id&&(r=(0,s.eG)(r,t)));return r}}class q extends L{post_process(e){return e}}class H extends s.Ag{constructor(e){super(),this.config=e,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=e.trim_offsets}static fromConfig(e){switch(e.type){case"WordPiece":return new Z(e);case"Metaspace":return new se(e);case"ByteLevel":return new Y(e);case"Replace":return new X(e);case"ByteFallback":return new K(e);case"Fuse":return new V(e);case"Strip":return new J(e);case"Sequence":return new ee(e);case"CTC":return new Q(e);case"BPEDecoder":return new te(e);default:throw new Error(`Unknown Decoder type: ${e.type}`)}}_call(e){return this.decode(e)}decode(e){return this.decode_chain(e).join("")}decode_chain(e){throw Error("`decode_chain` should be implemented in subclass.")}}class X extends H{decode_chain(e){let t=f(this.config.pattern);return null===t?e:e.map((e=>e.replaceAll(t,this.config.content)))}}class K extends H{constructor(e){super(e),this.text_decoder=new TextDecoder}decode_chain(e){let t=[],n=[];for(let s of e){let e=null;if(6===s.length&&s.startsWith("<0x")&&s.endsWith(">")){let t=parseInt(s.slice(3,5),16);isNaN(t)||(e=t)}if(null!==e)n.push(e);else{if(n.length>0){let e=this.text_decoder.decode(Uint8Array.from(n));t.push(e),n=[]}t.push(s)}}if(n.length>0){let e=this.text_decoder.decode(Uint8Array.from(n));t.push(e),n=[]}return t}}class V extends H{decode_chain(e){return[e.join("")]}}class J extends H{constructor(e){super(e),this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(e){return e.map((e=>{let t=0;for(let s=0;s<this.start&&e[s]===this.content;++s)t=s+1;let n=e.length;for(let s=0;s<this.stop;++s){const t=e.length-s-1;if(e[t]!==this.content)break;n=t}return e.slice(t,n)}))}}class Z extends H{constructor(e){super(e),this.cleanup=e.cleanup}decode_chain(e){return e.map(((e,t)=>(0!==t&&(e=e.startsWith(this.config.prefix)?e.replace(this.config.prefix,""):" "+e),this.cleanup&&(e=_(e)),e)))}}class Y extends H{constructor(e){super(e),this.byte_decoder=x,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(e){let t=e.join(""),n=new Uint8Array([...t].map((e=>this.byte_decoder[e])));return this.text_decoder.decode(n)}decode_chain(e){let t=[],n=[];for(let s of e)this.added_tokens.includes(s)?(n.length>0&&(t.push(this.convert_tokens_to_string(n)),n=[]),t.push(s)):n.push(s);return n.length>0&&t.push(this.convert_tokens_to_string(n)),t}}class Q extends H{constructor(e){super(e),this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(e){if(0===e.length)return"";let t=[e[0]];for(let s=1;s<e.length;++s)e[s]!==t.at(-1)&&t.push(e[s]);let n=t.filter((e=>e!==this.pad_token)).join("");return this.cleanup&&(n=_(n).replaceAll(this.word_delimiter_token," ").trim()),n}decode_chain(e){return[this.convert_tokens_to_string(e)]}}class ee extends H{constructor(e){super(e),this.decoders=e.decoders.map((e=>H.fromConfig(e)))}decode_chain(e){return this.decoders.reduce(((e,t)=>t.decode_chain(e)),e)}}class te extends H{constructor(e){super(e),this.suffix=this.config.suffix}decode_chain(e){return e.map(((t,n)=>t.replaceAll(this.suffix,n===e.length-1?"":" ")))}}class ne extends j{constructor(e){super(),this.addPrefixSpace=e.add_prefix_space,this.replacement=e.replacement,this.strRep=e.str_rep||this.replacement}pre_tokenize(e){"string"==typeof e&&(e=e.trimStart().split(/\s+/));const t=[];for(let n of e){let e=n.replaceAll(" ",this.strRep);this.addPrefixSpace&&!e.startsWith(this.replacement)&&(e=this.strRep+e),t.push(e)}return t}}class se extends H{constructor(e){super(e),this.addPrefixSpace=e.add_prefix_space,this.replacement=e.replacement}decode_chain(e){let t=[];for(let n=0;n<e.length;++n){let s=e[n].replaceAll(this.replacement," ");this.addPrefixSpace&&0==n&&s.startsWith(" ")&&(s=s.substring(1)),t.push(s)}return t}}class re extends z{constructor(e){super(e),this.charsmap=e.precompiled_charsmap}normalize(e){if((e=(e=e.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,"")).replace(/[\u0009\u000A\u000C\u000D\u1680\u200B\u200C\u200E\u200F\u2028\u2029\u2581\uFEFF\uFFFD]/gm," ")).includes("～")){const t=e.split("～");e=t.map((e=>e.normalize("NFKC"))).join("～")}else e=e.normalize("NFKC");return e}}class ie extends j{constructor(e){super(),this.tokenizers=e.pretokenizers.map((e=>j.fromConfig(e)))}pre_tokenize_text(e){return"string"==typeof e&&(e=[e]),this.tokenizers.reduce(((e,t)=>t.pre_tokenize(e)),e)}}class oe extends j{constructor(e){super()}pre_tokenize_text(e){return function(e){return e.match(/\S+/g)||[]}(e)}}class ae extends j{constructor(e){super(),this.config=e,this.pattern=f(this.config.pattern),this.content=this.config.content}pre_tokenize_text(e){return null===this.pattern?[e]:[e.replaceAll(this.pattern,this.config.content)]}}class le extends s.Ag{constructor(e,t){super(),this.normalizer=z.fromConfig(e.normalizer),this.pre_tokenizer=j.fromConfig(e.pre_tokenizer),this.model=w.fromConfig(e.model,t),this.post_processor=L.fromConfig(e.post_processor),this.decoder=H.fromConfig(e.decoder),this.decoder.end_of_word_suffix=this.model.end_of_word_suffix,this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[];for(let n of e.added_tokens){let e=n.id,t=n.content;this.added_tokens.push(t),this.model.tokens_to_ids.set(t,e),this.model.vocab[e]=t,n.special&&(this.special_tokens.push(t),this.all_special_ids.push(e))}this.special_tokens.push(...t.additional_special_tokens??[]),this.special_tokens=[...new Set(this.special_tokens)],this.decoder.added_tokens=this.added_tokens,this.added_tokens_regex=this.added_tokens.length>0?new RegExp("("+this.added_tokens.map(s.hr).join("|")+")"):null,this.mask_token=this.getToken(t,"mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken(t,"pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken(t,"sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.model_max_length=t.model_max_length,this.remove_space=t.remove_space,this.clean_up_tokenization_spaces=t.clean_up_tokenization_spaces??!0,this.do_lowercase_and_remove_accent=t.do_lowercase_and_remove_accent??!1,this.padding_side="right"}getToken(e,...t){for(let n of t){let t=e[n];if(t){if("object"==typeof t){if("AddedToken"===t.__type)return t.content;throw Error(`Unknown token: ${t}`)}return t}}return null}static async from_pretrained(e,{progress_callback:t=null,config:n=null,cache_dir:s=null,local_files_only:r=!1,revision:i="main"}={}){return new this(...await d(e,{progress_callback:t,config:n,cache_dir:s,local_files_only:r,revision:i}))}prepare_model_inputs(e){return e}_call(e,{text_pair:t=null,add_special_tokens:n=!0,padding:s=!1,truncation:r=null,max_length:a=null,return_tensor:l=!0}={}){let h;if(Array.isArray(e)){if(0===e.length)throw Error("text array must be non-empty");if(null!==t){if(!Array.isArray(t))throw Error("text_pair must also be an array");if(e.length!==t.length)throw Error("text and text_pair must have the same length");h=e.map(((e,s)=>this.encode(e,t[s],{add_special_tokens:n})))}else h=e.map((e=>this.encode(e,null,{add_special_tokens:n})))}else{if(null===e)throw Error("text may not be null");if(Array.isArray(t))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");h=[this.encode(e,t,{add_special_tokens:n})]}let c=(0,i.Fp)(h.map((e=>e.length)))[0];null===a&&(a=c),a=Math.min(a,this.model_max_length);let u=[];if(s||r)for(let i=0;i<h.length;++i)if(h[i].length!==a)if(h[i].length>a)r&&(h[i]=h[i].slice(0,a)),u.push(new Array(h[i].length).fill(1));else if(s){let e=a-h[i].length;"right"===this.padding_side?(u.push(new Array(h[i].length).fill(1).concat(new Array(e).fill(0))),h[i].push(...new Array(e).fill(this.pad_token_id))):(u.push(new Array(e).fill(0).concat(new Array(h[i].length).fill(1))),h[i].unshift(...new Array(e).fill(this.pad_token_id)))}else u.push(new Array(h[i].length).fill(1));else u.push(new Array(h[i].length).fill(1));else u=h.map((e=>new Array(e.length).fill(1)));if(l){if((!s||!r)&&h.some((e=>e.length!==h[0].length)))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.");let e=[h.length,h[0].length];h=new o.es("int64",BigInt64Array.from(h.flat().map(BigInt)),e),u=new o.es("int64",BigInt64Array.from(u.flat().map(BigInt)),e)}else Array.isArray(e)||(h=h[0],u=u[0]);let d={input_ids:h,attention_mask:u};return d=this.prepare_model_inputs(d),d}_encode_text(e){if(null===e)return null;let t=(this.added_tokens_regex?e.split(this.added_tokens_regex).filter((e=>e)):[e]).map((e=>{if(this.added_tokens.includes(e))return e;{!0===this.remove_space&&(e=e.trim().split(/\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(e=function(e){return g(e.toLowerCase())}(e)),null!==this.normalizer&&(e=this.normalizer(e));let t=null!==this.pre_tokenizer?this.pre_tokenizer(e):[e];return this.model(t)}})).flat();return t}encode(e,t=null,{add_special_tokens:n=!0}={}){let r=this._encode_text(e),i=this._encode_text(t),o=null!==this.post_processor&&n?this.post_processor(r,i):(0,s.eG)(r??[],i??[]);return this.model.convert_tokens_to_ids(o)}batch_decode(e,t={}){return e.map((e=>this.decode(e,t)))}decode(e,t={}){if(!Array.isArray(e)||0===e.length||!(0,s.Wy)(e[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(e,t)}decode_single(e,{skip_special_tokens:t=!1,clean_up_tokenization_spaces:n=null}){let s=this.model.convert_ids_to_tokens(e);t&&(s=s.filter((e=>!this.special_tokens.includes(e))));let r=this.decoder(s);return this.decoder.end_of_word_suffix&&(r=r.replaceAll(this.decoder.end_of_word_suffix," "),t&&(r=r.trim())),(n??this.clean_up_tokenization_spaces)&&(r=_(r)),r}}function he(e){if(e.input_ids instanceof o.es)e.token_type_ids=new o.es("int64",new BigInt64Array(e.input_ids.data.length),e.input_ids.dims);else{if(!Array.isArray(e.input_ids))throw new Error("Input ids must be a Tensor or an Array");Array.isArray(e.input_ids[0])?e.token_type_ids=e.input_ids.map((e=>new Array(e.length).fill(0))):e.token_type_ids=new Array(e.input_ids.length).fill(0)}return e}class ce extends le{prepare_model_inputs(e){return he(e)}}class ue extends le{prepare_model_inputs(e){return he(e)}}class de extends le{prepare_model_inputs(e){return he(e)}}class fe extends le{prepare_model_inputs(e){return he(e)}}class pe extends le{prepare_model_inputs(e){return he(e)}}class _e extends le{prepare_model_inputs(e){return he(e)}}class ge extends le{prepare_model_inputs(e){return he(e)}}class me extends le{}class we extends le{}class ye extends le{constructor(e,t){super(e,t),console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}prepare_model_inputs(e){return he(e)}}class be extends le{}class ke extends le{}class xe extends le{}class ve extends le{constructor(e,t){super(e,t),this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter((e=>this.languageRegex.test(e))),this.lang_to_token=e=>e}_build_translation_inputs(e,t,n){return Re(this,e,t,n)}}class Ae extends ve{}class ze extends le{}class Ee extends le{constructor(e,t){const n=".,!?…。，、।۔،",s=e.pre_tokenizer?.pretokenizers[0]?.pattern;s&&s.Regex===` ?[^(\\s|[${n}])]+`&&(s.Regex=` ?[^\\s${n}]+`),super(e,t)}}class Te extends le{}class Me extends le{}class Ce extends le{}class Ie extends le{}class Se extends le{}class Fe extends le{}function Re(e,t,n,s){if(!("language_codes"in e)||!Array.isArray(e.language_codes))throw new Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in e&&e.languageRegex instanceof RegExp))throw new Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in e)||"function"!=typeof e.lang_to_token)throw new Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");const r=s.src_lang,i=s.tgt_lang;if(!e.language_codes.includes(i))throw new Error(`Target language code "${i}" is not valid. Must be one of: {${e.language_codes.join(", ")}}`);if(void 0!==r){if(!e.language_codes.includes(r))throw new Error(`Source language code "${r}" is not valid. Must be one of: {${e.language_codes.join(", ")}}`);for(let t of e.post_processor.config.single)if("SpecialToken"in t&&e.languageRegex.test(t.SpecialToken.id)){t.SpecialToken.id=e.lang_to_token(r);break}}return s.forced_bos_token_id=e.model.convert_tokens_to_ids([e.lang_to_token(i)])[0],e._call(t,n)}class Oe extends le{constructor(e,t){super(e,t),this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter((e=>this.languageRegex.test(e))),this.lang_to_token=e=>e}_build_translation_inputs(e,t,n){return Re(this,e,t,n)}}class je extends le{constructor(e,t){super(e,t),this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter((e=>this.languageRegex.test(e))).map((e=>e.slice(2,-2))),this.lang_to_token=e=>`__${e}__`}_build_translation_inputs(e,t,n){return Re(this,e,t,n)}}const $e=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],Pe=new Map($e),Ne=new Map([...$e.map((([e,t])=>[t,e])),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);class Be extends le{_decode_asr(e,{return_timestamps:t=!1,return_language:n=!1,time_precision:s=null,force_full_sequences:r=!0}={}){if(null===s)throw Error("Must specify time_precision");let o=null;const a="word"===t;function l(){return{language:o,timestamp:[null,null],text:""}}const h=[];let c=l(),u=0;const d=this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1;let f=[],p=[],_=!1,g=null;const m=new Set(this.all_special_ids);for(let b of e){const e=b.tokens,n=a?b.token_timestamps:null;let r=null,w=d;if("stride"in b){const[t,n,i]=b.stride;if(u-=n,g=t-i,n&&(w=n/s+d),i)for(let o=e.length-1;o>=0;--o){const t=e[o];if(t>=d){if(null!==r&&(t-d)*s<g)break;r=t}}}let y=[],k=[];for(let g=0;g<e.length;++g){const b=e[g];if(m.has(b)){const e=this.decode([b]),n=Pe.get(e.slice(2,-2));if(void 0!==n){if(null!==o&&n!==o&&!t){f.push(y);const e=this.findLongestCommonSequence(f)[0],t=this.decode(e);c.text=t,h.push(c),f=[],y=[],c=l()}o=c.language=n}}else if(b>=d){const e=(b-d)*s+u,t=(0,i.NM)(e,2);if(null!==r&&b>=r)_=!0;else if(_||f.length>0&&b<w)_=!1;else if(null===c.timestamp[0])c.timestamp[0]=t;else if(t===c.timestamp[0]);else{c.timestamp[1]=t,f.push(y),a&&p.push(k);const[e,n]=this.findLongestCommonSequence(f,p),s=this.decode(e);c.text=s,a&&(c.words=this.collateWordTimestamps(e,n,o)),h.push(c),f=[],y=[],p=[],k=[],c=l()}}else if(y.push(b),a){let e,t=(0,i.NM)(n[g]+u,2);e=g+1<n.length?(0,i.NM)(n[g+1]+u,2):null,k.push([t,e])}}if("stride"in b){const[e,t,n]=b.stride;u+=e-n}y.length>0?(f.push(y),a&&p.push(k)):f.every((e=>0===e.length))&&(c=l(),f=[],y=[],p=[],k=[])}if(f.length>0){if(r&&t)throw new Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");const[e,n]=this.findLongestCommonSequence(f,p),s=this.decode(e);c.text=s,a&&(c.words=this.collateWordTimestamps(e,n,o)),h.push(c)}let w=Object.create(null);const y=h.map((e=>e.text)).join("");if(t||n){for(let e=0;e<h.length;++e){const s=h[e];t||delete s.timestamp,n||delete s.language}if(a){let e=[];for(let t of h)for(let n of t.words)e.push(n);w={chunks:e}}else w={chunks:h}}return[y,w]}findLongestCommonSequence(e,t=null){let n=e[0],s=n.length,r=[];const i=Array.isArray(t)&&t.length>0;let o=i?[]:null,a=i?t[0]:null;for(let l=1;l<e.length;++l){const h=e[l];let c=0,u=[s,s,0,0];const d=h.length;for(let e=1;e<s+d;++e){const t=e/1e4,r=Math.max(0,s-e),i=Math.min(s,s+d-e),o=n.slice(r,i),a=Math.max(0,e-s),l=Math.min(d,e),f=h.slice(a,l);if(o.length!==f.length)throw new Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");const p=o.filter(((e,t)=>e===f[t])).length,_=p/e+t;p>1&&_>c&&(c=_,u=[r,i,a,l])}const[f,p,_,g]=u,m=Math.floor((p+f)/2),w=Math.floor((g+_)/2);r.push(...n.slice(0,m)),n=h.slice(w),s=n.length,i&&(o.push(...a.slice(0,m)),a=t[l].slice(w))}return r.push(...n),i?(o.push(...a),[r,o]):[r,[]]}collateWordTimestamps(e,t,n){let[s,r,i]=this.combineTokensIntoWords(e,n),o=[];for(let a=0;a<s.length;++a){const e=i[a];o.push({text:s[a],timestamp:[t[e.at(0)][0],t[e.at(-1)][1]]})}return o}combineTokensIntoWords(e,t,n="\"'“¡¿([{-",s="\"'.。,，!！?？:：”)]}、"){let r,i,o;return["chinese","japanese","thai","lao","myanmar"].includes(t=t??"english")?[r,i,o]=this.splitTokensOnUnicode(e):[r,i,o]=this.splitTokensOnSpaces(e),this.mergePunctuations(r,i,o,n,s)}decode(e,t){let n;return n=t&&t.decode_with_timestamps?this.decodeWithTimestamps(e,t):super.decode(e,t),n}decodeWithTimestamps(e,t){const n=t?.time_precision??.02,s=Array.from(this.all_special_ids).at(-1)+1;let r=[[]];for(let o of e)if(o>=s){let e=(o-s)*n;e=(0,i.NM)(e,2),r.push(`<|${e}|>`),r.push([])}else r[r.length-1].push(o);return r=r.map((e=>"string"==typeof e?e:super.decode(e,t))),r.join("")}splitTokensOnUnicode(e){const t=this.decode(e,{decode_with_timestamps:!0});let n=[],s=[],r=[],i=[],o=[],a=0;for(let l=0;l<e.length;++l){const h=e[l];i.push(h),o.push(l);const c=this.decode(i,{decode_with_timestamps:!0});c.includes("�")&&"�"!==t[a+c.indexOf("�")]||(n.push(c),s.push(i),r.push(o),i=[],o=[],a+=c.length)}return[n,s,r]}splitTokensOnSpaces(e){let[t,n,s]=this.splitTokensOnUnicode(e),r=[],i=[],o=[];const a=new RegExp(`^[${m}]$`,"gu");for(let l=0;l<t.length;++l){const e=t[l],h=n[l],c=s[l],u=h[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),d=e.startsWith(" "),f=e.trim(),p=a.test(f);if(u||d||p||0===r.length)r.push(e),i.push(h),o.push(c);else{const t=r.length-1;r[t]+=e,i[t].push(...h),o[t].push(...c)}}return[r,i,o]}mergePunctuations(e,t,n,r,i){let o=structuredClone(e),a=structuredClone(t),l=structuredClone(n),h=o.length-2,c=o.length-1;for(;h>=0;)o[h].startsWith(" ")&&r.includes(o[h].trim())?(o[c]=o[h]+o[c],a[c]=(0,s.eG)(a[h],a[c]),l[c]=(0,s.eG)(l[h],l[c]),o[h]="",a[h]=[],l[h]=[]):c=h,--h;for(h=0,c=1;c<o.length;)!o[h].endsWith(" ")&&i.includes(o[c])?(o[h]+=o[c],a[h]=(0,s.eG)(a[h],a[c]),l[h]=(0,s.eG)(l[h],l[c]),o[c]="",a[c]=[],l[c]=[]):h=c,++c;return[o.filter((e=>e)),a.filter((e=>e.length>0)),l.filter((e=>e.length>0))]}get_decoder_prompt_ids({language:e=null,task:t=null,no_timestamps:n=!0}={}){let s=[];if(e){e=e.toLowerCase();let t=Ne.get(e);if(void 0===t){if(!Pe.has(e)){const t=2===e.length?Pe.keys():Pe.values();throw new Error(`Language "${e}" is not supported. Must be one of: ${JSON.stringify(t)}`)}t=e}let n=this.model.tokens_to_ids.get(`<|${t}|>`);if(void 0===n)throw new Error(`Unable to find language "${t}" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.`);s.push(n)}else s.push(null);if(t){if("transcribe"!==(t=t.toLowerCase())&&"translate"!==t)throw new Error(`Task "${t}" is not supported. Must be one of: ["transcribe", "translate"]`);let e=this.model.tokens_to_ids.get(`<|${t}|>`);if(void 0===e)throw new Error(`Unable to find task "${t}" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.`);s.push(e)}else s.push(null);if(n){let e=this.model.tokens_to_ids.get("<|notimestamps|>");if(void 0===e)throw new Error('Unable to find "<|notimestamps|>" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.');s.push(e)}return s.map(((e,t)=>[t+1,e])).filter((e=>null!==e[1]))}}class Ue extends le{}class Le extends le{}class Ge extends le{constructor(e,t){super(e,t),this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter((e=>this.languageRegex.test(e))),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}_encode_text(e){if(null===e)return null;let[t,...n]=e.trim().split(this.languageRegex);if(0===n.length)return super._encode_text(t);if(2===n.length){let[e,t]=n;return this.supported_language_codes.includes(e)||console.warn(`Unsupported language code "${e}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`),(0,s.eG)([e],super._encode_text(t))}}}class De extends le{}class We extends le{}class qe extends le{}class He extends le{}class Xe{static TOKENIZER_CLASS_MAPPING={T5Tokenizer:be,DistilBertTokenizer:me,CamembertTokenizer:we,DebertaTokenizer:pe,DebertaV2Tokenizer:_e,BertTokenizer:ce,HerbertTokenizer:ge,XLMTokenizer:ye,MobileBertTokenizer:de,SqueezeBertTokenizer:fe,AlbertTokenizer:ue,GPT2Tokenizer:ke,BartTokenizer:xe,MBartTokenizer:ve,MBart50Tokenizer:Ae,RobertaTokenizer:ze,WhisperTokenizer:Be,CodeGenTokenizer:Ue,CLIPTokenizer:Le,MarianTokenizer:Ge,BloomTokenizer:Ee,NllbTokenizer:Oe,M2M100Tokenizer:je,LlamaTokenizer:Te,CodeLlamaTokenizer:Me,XLMRobertaTokenizer:Ce,MPNetTokenizer:Ie,FalconTokenizer:Se,GPTNeoXTokenizer:Fe,Wav2Vec2CTCTokenizer:De,BlenderbotTokenizer:We,BlenderbotSmallTokenizer:qe,SpeechT5Tokenizer:He,PreTrainedTokenizer:le};static async from_pretrained(e,{quantized:t=!0,progress_callback:n=null,config:s=null,cache_dir:r=null,local_files_only:i=!1,revision:o="main"}={}){let[a,l]=await d(e,{quantized:t,progress_callback:n,config:s,cache_dir:r,local_files_only:i,revision:o}),h=l.tokenizer_class.replace(/Fast$/,""),c=this.TOKENIZER_CLASS_MAPPING[h];return c||(console.warn(`Unknown tokenizer class "${h}", attempting to construct from base class.`),c=le),new c(a,l)}}var Ke=n(2622),Ve=n(8563),Je=n(8741);const Ze="undefined"!=typeof self;let Ye,Qe,et;if(Ze)Ye=(e,t)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(e,t)},et=self.createImageBitmap,Qe=self.ImageData;else{if(!Je)throw new Error("Unable to load image processing library.");et=async e=>{const t=(await e.metadata()).channels;let{data:n,info:s}=await e.raw().toBuffer({resolveWithObject:!0});const r=new nt(new Uint8ClampedArray(n),s.width,s.height,s.channels);return void 0!==t&&t!==s.channels&&r.convert(t),r}}const tt={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"};class nt{_CONTENT_TYPE_MAP={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};constructor(e,t,n,s){this.data=e,this.width=t,this.height=n,this.channels=s}static async read(e){if(e instanceof nt)return e;if((0,s.HD)(e)||e instanceof URL)return await this.fromURL(e);throw new Error("Unsupported input type: "+typeof e)}static async fromURL(e){let t=await(0,r.hn)(e);if(200!==t.status)throw new Error(`Unable to read image from "${e}" (${t.status} ${t.statusText})`);let n=await t.blob();return this.fromBlob(n)}static async fromBlob(e){if(Ze){let t=await et(e);const n=Ye(t.width,t.height).getContext("2d");return n.drawImage(t,0,0),new this(n.getImageData(0,0,t.width,t.height).data,t.width,t.height,4)}{let t=Je(await e.arrayBuffer());return await et(t)}}grayscale(){if(1===this.channels)return this;let e=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let t=0,n=0;t<this.data.length;t+=this.channels){const s=this.data[t],r=this.data[t+1],i=this.data[t+2];e[n++]=Math.round(.2989*s+.587*r+.114*i)}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,1)}rgb(){if(3===this.channels)return this;let e=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let t=0,n=0;t<this.data.length;++t)e[n++]=this.data[t],e[n++]=this.data[t],e[n++]=this.data[t];break;case 4:for(let t=0,n=0;t<this.data.length;t+=4)e[n++]=this.data[t],e[n++]=this.data[t+1],e[n++]=this.data[t+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,3)}rgba(){if(4===this.channels)return this;let e=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let t=0,n=0;t<this.data.length;++t)e[n++]=this.data[t],e[n++]=this.data[t],e[n++]=this.data[t],e[n++]=255;break;case 3:for(let t=0,n=0;t<this.data.length;t+=3)e[n++]=this.data[t],e[n++]=this.data[t+1],e[n++]=this.data[t+2],e[n++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,4)}async resize(e,t,{resample:n=2}={}){let s=tt[n]??n;if(Ze){let n=this.channels,s=this.toCanvas();const r=Ye(e,t).getContext("2d");return r.drawImage(s,0,0,e,t),new nt(r.getImageData(0,0,e,t).data,e,t,4).convert(n)}{let n=this.toSharp();switch(s){case"box":case"hamming":"box"!==s&&"hamming"!==s||(console.warn(`Resampling method ${s} is not yet supported. Using bilinear instead.`),s="bilinear");case"nearest":case"bilinear":case"bicubic":n=n.affine([e/this.width,0,0,t/this.height],{interpolator:s});break;case"lanczos":n=n.resize({width:e,height:t,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${s} is not supported.`)}return await et(n)}}async pad([e,t,n,s]){if(e=Math.max(e,0),t=Math.max(t,0),n=Math.max(n,0),s=Math.max(s,0),0===e&&0===t&&0===n&&0===s)return this;if(Ze){let r=this.channels,i=this.toCanvas(),o=this.width+e+t,a=this.height+n+s;const l=Ye(o,a).getContext("2d");return l.drawImage(i,0,0,this.width,this.height,e,n,o,a),new nt(l.getImageData(0,0,o,a).data,o,a,4).convert(r)}{let r=this.toSharp().extend({left:e,right:t,top:n,bottom:s});return await et(r)}}async center_crop(e,t){if(this.width===e&&this.height===t)return this;let n=(this.width-e)/2,s=(this.height-t)/2;if(Ze){let r=this.channels,i=this.toCanvas();const o=Ye(e,t).getContext("2d");let a=0,l=0,h=0,c=0;return n>=0?a=n:h=-n,s>=0?l=s:c=-s,o.drawImage(i,a,l,e,t,h,c,e,t),new nt(o.getImageData(0,0,e,t).data,e,t,4).convert(r)}{let r=this.toSharp();if(n>=0&&s>=0)r=r.extract({left:Math.floor(n),top:Math.floor(s),width:e,height:t});else if(n<=0&&s<=0){let i=Math.floor(-s),o=Math.floor(-n);r=r.extend({top:i,left:o,right:e-this.width-o,bottom:t-this.height-i})}else{let i=[0,0],o=0;s<0?(i[0]=Math.floor(-s),i[1]=t-this.height-i[0]):o=Math.floor(s);let a=[0,0],l=0;n<0?(a[0]=Math.floor(-n),a[1]=e-this.width-a[0]):l=Math.floor(n),r=r.extend({top:i[0],bottom:i[1],left:a[0],right:a[1]}).extract({left:l,top:o,width:e,height:t})}return await et(r)}}toCanvas(){if(!Ze)throw new Error("toCanvas() is only supported in browser environments.");let e=this.clone().rgba(),t=Ye(e.width,e.height),n=new Qe(e.data,e.width,e.height);return t.getContext("2d").putImageData(n,0,0),t}_update(e,t,n,s=null){return this.data=e,this.width=t,this.height=n,null!==s&&(this.channels=s),this}clone(){return new nt(this.data.slice(),this.width,this.height,this.channels)}convert(e){if(this.channels===e)return this;switch(e){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}save(e){if(Ze){const t=e.split(".").pop().toLowerCase(),n=this._CONTENT_TYPE_MAP[t]??"image/png",s=this.toCanvas().toDataURL(n),r=document.createElement("a");r.href=s,r.download=e,r.click(),r.remove()}else{if(!Ve.O.useFS)throw new Error("Unable to save the image because filesystem is disabled in this environment.");this.toSharp().toFile(e)}}toSharp(){if(Ze)throw new Error("toSharp() is only supported in server-side environments.");return Je(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}async function st(e,t){if("undefined"==typeof AudioContext)throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");const n=await(await(0,r.hn)(e)).arrayBuffer(),s=new AudioContext({sampleRate:t});void 0===t&&console.warn(`No sampling rate provided, using default of ${s.sampleRate}Hz.`);const i=await s.decodeAudioData(n);let o;if(2===i.numberOfChannels){const e=Math.sqrt(2);let t=i.getChannelData(0),n=i.getChannelData(1);o=new Float32Array(t.length);for(let s=0;s<i.length;++s)o[s]=e*(t[s]+n[s])/2}else o=i.getChannelData(0);return o}function rt([e,t,n,s]){return[e-n/2,t-s/2,e+n/2,t+s/2]}function it(e,t=.5,n=null){const s=e.logits,r=e.pred_boxes,[o,a,l]=s.dims;if(null!==n&&n.length!==o)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let h=[];for(let c=0;c<o;++c){let e=null!==n?n[c]:null,o={boxes:[],classes:[],scores:[]},u=s[c],d=r[c];for(let n=0;n<a;++n){let s=u[n],r=(0,i.Fp)(s.data)[1];if(r===l-1)continue;let a=(0,i.XA)(s.data)[r];if(a>t){let t=d[n].data;t=rt(t),null!==e&&(t=t.map(((t,n)=>t*e[(n+1)%2]))),o.boxes.push(t),o.classes.push(r),o.scores.push(a)}}h.push(o)}return h}class ot extends s.Ag{constructor(e){super(),this.config=e}}class at extends ot{constructor(e){super(e),this.image_mean=this.config.image_mean,this.image_std=this.config.image_std,this.resample=this.config.resample??2,this.do_rescale=this.config.do_rescale??!0,this.rescale_factor=this.config.rescale_factor??1/255,this.do_normalize=this.config.do_normalize,this.do_resize=this.config.do_resize,this.do_thumbnail=this.config.do_thumbnail,this.size=this.config.size,this.do_center_crop=this.config.do_center_crop,this.crop_size=this.config.crop_size,this.do_convert_rgb=this.config.do_convert_rgb??!0,this.pad_size=this.config.pad_size,this.do_pad=this.config.do_pad,this.do_pad&&!this.pad_size&&void 0!==this.size.width&&void 0!==this.size.height&&(this.pad_size=this.size)}async thumbnail(e,t,n=2){const s=e.height,r=e.width,i=t.height,o=t.width;let a=Math.min(s,i),l=Math.min(r,o);return a===s&&l===r?e:(s>r?l=Math.floor(r*a/s):r>s&&(a=Math.floor(s*l/r)),await e.resize(l,a,{resample:n}))}async preprocess(e){this.do_convert_rgb&&(e=e.rgb());const t=e.width,n=e.height;if(this.do_resize){let s,r;if(this.do_thumbnail){const{height:e,width:t}=this.size;s=Math.min(e,t)}else Number.isInteger(this.size)?(s=this.size,r=this.config.max_size??s):(s=this.size.shortest_edge,r=this.size.longest_edge);if(void 0!==s||void 0!==r){const i=void 0===s?1:Math.max(s/t,s/n),o=t*i,a=n*i,l=void 0===r?1:Math.min(r/o,r/a),h=Math.floor(Number((o*l).toFixed(2))),c=Math.floor(Number((a*l).toFixed(2)));e=await e.resize(h,c,{resample:this.resample})}else{if(void 0===this.size.width||void 0===this.size.height)throw new Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(this.size)}`);e=await e.resize(this.size.width,this.size.height,{resample:this.resample})}}if(this.do_thumbnail&&(e=await this.thumbnail(e,this.size,this.resample)),this.do_center_crop){let t,n;Number.isInteger(this.crop_size)?(t=this.crop_size,n=this.crop_size):(t=this.crop_size.width,n=this.crop_size.height),e=await e.center_crop(t,n)}let s=[e.height,e.width];if(this.do_pad&&this.pad_size){let t=0,n=this.pad_size.width-e.width,s=0,r=this.pad_size.height-e.height;e=await e.pad([t,n,s,r])}const r=Float32Array.from(e.data);if(this.do_rescale)for(let o=0;o<r.length;++o)r[o]=this.rescale_factor*r[o];if(this.do_normalize){let t=this.image_mean;Array.isArray(this.image_mean)||(t=new Array(e.channels).fill(t));let n=this.image_std;if(Array.isArray(this.image_std)||(n=new Array(e.channels).fill(t)),t.length!==e.channels||n.length!==e.channels)throw new Error(`When set to arrays, the length of \`image_mean\` (${t.length}) and \`image_std\` (${n.length}) must match the number of channels in the image (${e.channels}).`);for(let s=0;s<r.length;s+=e.channels)for(let t=0;t<e.channels;++t)r[s+t]=(r[s+t]-this.image_mean[t])/this.image_std[t]}let i=[e.height,e.width,e.channels],a=new o.es("float32",r,i);return{original_size:[n,t],reshaped_input_size:s,pixel_values:(0,o.p4)(a,[2,0,1])}}async _call(e,...t){Array.isArray(e)||(e=[e]);const n=await Promise.all(e.map((e=>this.preprocess(e))));n.forEach((e=>e.pixel_values.dims=[1,...e.pixel_values.dims]));return{pixel_values:(0,o.d3)(n.map((e=>e.pixel_values))),original_sizes:n.map((e=>e.original_size)),reshaped_input_sizes:n.map((e=>e.reshaped_input_size))}}}class lt extends at{}class ht extends at{}class ct extends at{}class ut extends at{}class dt extends at{}class ft extends at{}class pt extends at{async _call(e){const t=await super._call(e),n=[t.pixel_values.dims[0],64,64],s=new o.es("int64",new BigInt64Array(n.reduce(((e,t)=>e*t))).fill(1n),n);return{...t,pixel_mask:s}}post_process_object_detection(...e){return it(...e)}remove_low_and_no_objects(e,t,n,s){let r=[],o=[],a=[];for(let l=0;l<e.dims[0];++l){let h=e[l],c=t[l],u=(0,i.Fp)(h.data)[1];if(u===s)continue;let d=(0,i.XA)(h.data)[u];d>n&&(r.push(c),o.push(d),a.push(u))}return[r,o,a]}check_segment_validity(e,t,n,s=.5,r=.8){let i=[],o=0,a=0;for(let h=0;h<e.length;++h)e[h]===n&&(i.push(h),++o),t[n].data[h]>=s&&++a;let l=o>0&&a>0;if(l){l=o/a>r}return[l,i]}compute_segments(e,t,n,s,r,i=null,a=null){let[l,h]=a??e[0].dims,c=new o.es("int32",new Int32Array(l*h),[l,h]),u=[];if(null!==a)for(let _=0;_<e.length;++_)e[_]=(0,o.sX)(e[_],a,"bilinear",!1);let d=new Int32Array(e[0].data.length),f=new Float32Array(e[0].data.length);for(let o=0;o<e.length;++o){let n=t[o];for(let t=0;t<e[o].data.length;++t)e[o].data[t]*=n,e[o].data[t]>f[t]&&(d[t]=o,f[t]=e[o].data[t])}let p=0;for(let o=0;o<n.length;++o){let i=n[o],[a,l]=this.check_segment_validity(d,e,o,s,r);if(a){++p;for(let e of l)c.data[e]=p;u.push({id:p,label_id:i,score:t[o]})}}return[c,u]}post_process_panoptic_segmentation(e,t=.5,n=.5,s=.8,r=null,i=null){null===r&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),r=new Set);const a=e.logits,l=e.pred_masks.sigmoid();let[h,c,u]=a.dims;if(u-=1,null!==i&&i.length!==h)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let d=[];for(let f=0;f<h;++f){let e=null!==i?i[f]:null,h=a[f],c=l[f],[p,_,g]=this.remove_low_and_no_objects(h,c,t,u);if(0===g.length){let[t,n]=e??c.dims.slice(-2),s=new o.es("int32",new Int32Array(t*n).fill(-1),[t,n]);d.push({segmentation:s,segments_info:[]});continue}let[m,w]=this.compute_segments(p,_,g,n,s,r,e);d.push({segmentation:m,segments_info:w})}return d}post_process_instance_segmentation(){throw Error("Not implemented yet")}}class _t extends at{post_process_object_detection(...e){return it(...e)}}class gt extends at{async _call(e,t){let{pixel_values:n,original_sizes:r,reshaped_input_sizes:i}=await super._call(e),a=(0,s.jg)(t);if(3===a.length)a=[1,...a],t=[t];else if(4!==a.length)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let s=0;s<t.length;++s){let e=r[s],n=i[s],o=[n[0]/e[0],n[1]/e[1]];for(let r=0;r<t[s].length;++r)for(let e=0;e<t[s][r].length;++e)for(let n=0;n<t[s][r][e].length;++n)t[s][r][e][n]*=o[n]}return{pixel_values:n,original_sizes:r,reshaped_input_sizes:i,input_points:new o.es("int64",BigInt64Array.from(t.flat(1/0).map((e=>BigInt(Math.round(e))))),a)}}post_process_masks(e,t,n,{mask_threshold:s=0,binarize:r=!0,pad_size:i=null}={}){let a=[],l=[(i=i??this.pad_size).height,i.width];for(let h=0;h<t.length;++h){let i=t[h],c=n[h],u=e[h],d=[];for(let e=0;e<u.dims[0];++e){let t=u[e],n=(0,o.sX)(t,l,"bilinear",!1);n=n.slice(null,[0,c[0]],[0,c[1]]),n=(0,o.sX)(u,i,"bilinear",!1),r&&(n=new o.es("bool",Array.from(n.data).map((e=>e>s)),n.dims)),n.dims=[1,...n.dims],d.push(n)}let f=(0,o.d3)(d);a.push(f)}return a}}class mt extends ot{constructor(e){super(e),this.config.mel_filters??=function(e,t,n=128){n=Math.floor(n);const s=Math.floor(1+t/2),r=new Array(n),o=(0,i.bi)(t,1/e),a=45.245640471924965/(n+1),l=200/3,h=new Array(n+2),c=1e3/l,u=Math.log(6.4)/27,d=new Array(h.length);for(let i=0;i<h.length;++i){const e=i*a+0;h[i]=e>=c?1e3*Math.exp(u*(e-c)):0+l*e,d[i]=o.map((e=>h[i]-e))}const f=h.slice(1).map(((e,t)=>1/(e-h[t])));for(let i=0;i<r.length;++i){r[i]=new Array(s);const e=f[i],t=f[i+1],n=d[i],o=d[i+2],a=2/(h[i+2]-h[i]);for(let s=0;s<r[i].length;++s){const l=-n[s]*e,h=o[s]*t;r[i][s]=Math.max(0,Math.min(l,h))*a}}return r}(this.config.sampling_rate,this.config.n_fft,this.config.feature_size)}calcOffset(e,t){return Math.abs((e+t)%(2*t)-t)}padReflect(e,t,n){const s=new Float32Array(e.length+t+n),r=e.length-1;for(let i=0;i<e.length;++i)s[t+i]=e[i];for(let i=1;i<=t;++i)s[t-i]=e[this.calcOffset(i,r)];for(let i=1;i<=n;++i)s[r+t+i]=e[this.calcOffset(r-i,r)];return s}stft(e,t){const n=this.config.n_fft,s=2*(n-1),r=2*(2*n-1),o=2**Math.ceil(Math.log2(r)),a=n+2,l=new Float32Array(a*e.length),h=new Float32Array(r),c=new Float32Array(o),u=new Float32Array(o),d=new Float32Array(o),f=new Float32Array(o),p=new Float32Array(o),_=new Float32Array(o),g=-2*Math.PI/n,m=Math.cos(g),w=Math.sin(g);for(let i=0;i<r>>1;++i){const e=(i+1-n)**2/2,t=Math.sqrt(m**2+w**2)**e,s=e*Math.atan2(w,m);let r=2*i;h[r]=t*Math.cos(s),h[r+1]=t*Math.sin(s),c[r]=h[r],c[r+1]=-h[r+1]}const y=h.subarray(s,r),b=new i.vw(o>>1);b.transform(f,c);for(let i=0;i<e.length;++i){const n=e[i];for(let e=0;e<y.length;e+=2){const s=e+1,r=e>>1,i=n[r]*t[r];u[e]=i*y[e],u[s]=i*y[s]}b.transform(p,u);for(let e=0;e<f.length;e+=2){const t=e+1;d[e]=p[e]*f[e]-p[t]*f[t],d[t]=p[e]*f[t]+p[t]*f[e]}b.inverseTransform(_,d);const r=i*a;for(let e=0;e<a;e+=2){const t=_[e+s],n=_[e+s+1],i=y[e],o=y[e+1],a=r+e;l[a]=t*i-n*o,l[a+1]=t*o+n*i}}return{data:l,dims:[e.length,a]}}fram_wave(e,t=!0){const n=[],s=Math.floor((this.config.n_fft-1)/2)+1,r=e.length;for(let i=0;i<r+1;i+=this.config.hop_length){let o;if(t){let t=i>s?i-s:0,n=i<r-s?i+s:r;o=e.subarray(t,n),0===t?o=this.padReflect(o,-i+s,0):n===r&&(o=this.padReflect(o,0,i-r+s))}else{o=new Float32Array(this.config.n_fft);const t=e.subarray(i,i+this.config.n_fft);t.length<this.config.n_fft?(o.set(t),o.fill(0,t.length,this.config.n_fft)):o=t}n.push(o)}return n}hanning(e){if(e<1)return[];if(1===e)return[1];const t=e-1,n=new Float32Array(t);for(let s=0;s<t;++s){const r=2*s-e+1;n[s]=.5+.5*Math.cos(Math.PI*r/t)}return n}_extract_fbank_features(e){const t=new Float32Array(this.config.n_samples);t.set(e);const n=this.hanning(this.config.n_fft+1),s=this.fram_wave(t),r=this.stft(s,n),i=r.data,o=r.dims[0]-1,a=r.dims[1]>>1,l=new Float32Array(o*a);for(let _=0;_<o;++_)for(let e=0;e<a;++e){let t=_*a+e,n=t<<1,s=i[n]**2+i[n+1]**2;l[t]=s}const h=this.config.mel_filters,c=h.length,u=new Float32Array(c*o);let d=0;for(let _=0;_<c;++_){const e=h[_];for(let t=0;t<o;++t){let n=0;for(let s=0;s<a;++s)n+=e[s]*l[t*a+s];u[d++]=n}}const f=new Float32Array(u.length);let p=0;for(let _=0;_<u.length;++_){const e=Math.max(1e-10,u[_]),t=Math.log10(e);f[_]=t,p=Math.max(t,p)}for(let _=0;_<f.length;++_)f[_]=Math.max(f[_],p-8),f[_]=(f[_]+4)/4;return{data:f,dims:[c,o]}}async _call(e){if(!(e instanceof Float32Array||e instanceof Float64Array))throw new Error(`WhisperFeatureExtractor expects input to be a Float32Array or a Float64Array, but got ${e?.constructor?.name??typeof e} instead.If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`);e.length>this.config.n_samples&&console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`.");let t=e.slice(0,this.config.n_samples),n=this._extract_fbank_features(t);return{input_features:new o.es("float32",n.data,[1,...n.dims])}}}class wt extends ot{_zero_mean_unit_var_norm(e){const t=e.reduce(((e,t)=>e+t),0)/e.length,n=e.reduce(((e,n)=>e+(n-t)**2),0)/e.length;return e.map((e=>(e-t)/Math.sqrt(n+1e-7)))}async _call(e){if(!(e instanceof Float32Array||e instanceof Float64Array))throw new Error(`Wav2Vec2FeatureExtractor expects input to be a Float32Array or a Float64Array, but got ${e?.constructor?.name??typeof e} instead.If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`);e instanceof Float64Array&&(e=new Float32Array(e));let t=e;this.config.do_normalize&&(t=this._zero_mean_unit_var_norm(t));const n=[1,t.length];return{input_values:new o.es("float32",t,n),attention_mask:new o.es("int64",new BigInt64Array(t.length).fill(1n),n)}}}class yt extends ot{}class bt extends s.Ag{constructor(e){super(),this.feature_extractor=e}async _call(e,...t){return await this.feature_extractor(e)}}class kt extends bt{async _call(e,t){return await this.feature_extractor(e,t)}post_process_masks(...e){return this.feature_extractor.post_process_masks(...e)}}class xt extends bt{async _call(e){return await this.feature_extractor(e)}}class vt extends bt{async _call(e){return await this.feature_extractor(e)}}class At extends bt{async _call(e){return await this.feature_extractor(e)}}class zt{static FEATURE_EXTRACTOR_CLASS_MAPPING={WhisperFeatureExtractor:mt,ViTFeatureExtractor:ht,MobileViTFeatureExtractor:ct,ConvNextFeatureExtractor:lt,BeitFeatureExtractor:dt,DeiTFeatureExtractor:ut,DetrFeatureExtractor:pt,YolosFeatureExtractor:_t,DonutFeatureExtractor:ft,SamImageProcessor:gt,Wav2Vec2FeatureExtractor:wt,SpeechT5FeatureExtractor:yt};static PROCESSOR_CLASS_MAPPING={WhisperProcessor:xt,Wav2Vec2ProcessorWithLM:vt,SamProcessor:kt,SpeechT5Processor:At};static async from_pretrained(e,{progress_callback:t=null,config:n=null,cache_dir:s=null,local_files_only:i=!1,revision:o="main"}={}){let a=n??await(0,r.yM)(e,"preprocessor_config.json",!0,{progress_callback:t,config:n,cache_dir:s,local_files_only:i,revision:o}),l=a.feature_extractor_type??a.image_processor_type,h=this.FEATURE_EXTRACTOR_CLASS_MAPPING[l];if(!h){if(void 0===a.size)throw new Error(`Unknown Feature Extractor type: ${l}`);console.warn(`Feature extractor type "${l}" not found, assuming ImageFeatureExtractor due to size parameter in config.`),h=at}return new(this.PROCESSOR_CLASS_MAPPING[a.processor_class]??bt)(new h(a))}}async function Et(e){return Array.isArray(e)||(e=[e]),e=await Promise.all(e.map((e=>nt.read(e))))}class Tt extends s.Ag{constructor({task:e,model:t,tokenizer:n=null,processor:s=null}){super(),this.task=e,this.model=t,this.tokenizer=n,this.processor=s}async dispose(){await this.model.dispose()}async _call(e,...t){let n=this.tokenizer(e,{padding:!0,truncation:!0});return[n,await this.model(n)]}}class Mt extends Tt{_key=null;async _call(e,t={}){Array.isArray(e)||(e=[e]),this.model.config.prefix&&(e=e.map((e=>this.model.config.prefix+e)));let n=this.model.config.task_specific_params;n&&n[this.task]&&n[this.task].prefix&&(e=e.map((e=>n[this.task].prefix+e)));let s,r={padding:!0,truncation:!0};s=this instanceof Ct&&"_build_translation_inputs"in this.tokenizer?this.tokenizer._build_translation_inputs(e,r,t).input_ids:this.tokenizer(e,r).input_ids;let i=await this.model.generate(s,t),o=this.tokenizer.batch_decode(i,{skip_special_tokens:!0});return null!==this._key&&(o=o.map((e=>null===this._key?e:{[this._key]:e}))),o}}class Ct extends Mt{_key="translation_text"}Ke.o$X,Ke.OjJ,Ke.wiU,Ke.t78,Ke.Kf0,Ke.Kf0,Ke.Kf0,Ke.Hqk,Ke.o$X,Ke.K2m,Ke.hZO,Ke.ENH,Ke.lbf,Ke.tLj,Ke.En$,Ke.U$$,Ke.$Sz,Ke.Zn,Ke.DcG,Ke.$Sz;n(3675)},9346:function(e,t,n){"use strict";function s(e,t){null!==e&&e(t)}function r(e){return Object.fromEntries(Object.entries(e).map((([e,t])=>[t,e])))}function i(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}n.d(t,{$2:function(){return r},Ag:function(){return o},Gg:function(){return c},HD:function(){return a},O7:function(){return p},Sw:function(){return d},T2:function(){return s},Wy:function(){return h},eG:function(){return f},fU:function(){return l},hr:function(){return i},jg:function(){return u}});const o=class{constructor(){let e=function(...t){return e._call(...t)};return Object.setPrototypeOf(e,new.target.prototype)}_call(...e){throw Error("Must implement _call method in subclass")}};function a(e){return"string"==typeof e||e instanceof String}function l(e){return"TypedArray"===e?.prototype?.__proto__?.constructor?.name}function h(e){return Number.isInteger(e)||"bigint"==typeof e}function c(e){return null!=e}function u(e){const t=[];let n=e;for(;Array.isArray(n);)t.push(n.length),n=n[0];return t}function d(e,t,n=void 0){const s=e[t];if(void 0!==s)return delete e[t],s;if(void 0===n)throw Error(`Key ${t} does not exist in object.`);return n}function f(...e){return Array.prototype.concat.apply([],e)}function p(...e){return e.reduce(((e,t)=>e.flatMap((e=>t.map((t=>[e,t]))))))}},7082:function(e,t,n){"use strict";n.d(t,{C9:function(){return l},CJ:function(){return _},E:function(){return a},GU:function(){return c},Jj:function(){return f},Jm:function(){return i},Pg:function(){return u},Z4:function(){return m},aP:function(){return g},dZ:function(){return h},ez:function(){return p},jF:function(){return d}});n(4e3);var s=n(9346),r=n(1912);class i extends s.Ag{constructor(){super(),this.processors=[]}push(e){this.processors.push(e)}extend(e){this.processors.push(...e)}_call(e,t){for(let n of t)this.processors.forEach((t=>t(e,n)))}[Symbol.iterator](){return this.processors.values()}}class o extends s.Ag{_call(e,t){throw Error("`_call` should be implemented in a subclass")}}class a extends o{constructor(e){super(),this.force_token_map=Object.fromEntries(e??[])}_call(e,t){let n=this.force_token_map[e.length];return(0,s.Gg)(n)&&(t.data.fill(-1/0),t.data[n]=0),t}}class l extends o{constructor(e){super(),this.bos_token_id=e}_call(e,t){return 1===e.length&&(t.data.fill(-1/0),t.data[this.bos_token_id]=0),t}}class h extends o{constructor(e,t){super(),this.max_length=e,this.forced_eos_token_id=t}_call(e,t){}}class c extends o{constructor(e,t){super(),this.begin_suppress_tokens=e,this.begin_index=t}_call(e,t){if(e.length===this.begin_index)for(let n of this.begin_suppress_tokens)t.data[n]=-1/0;return t}}class u extends o{constructor(e){super(),this.eos_token_id=e.eos_token_id,this.no_timestamps_token_id=e.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=(e.forced_decoder_ids||[]).length+2,e.forced_decoder_ids.slice(-1)[0][1]===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=e.max_initial_timestamp_index}_call(e,t){if(t.data[this.no_timestamps_token_id]=-1/0,e.length===this.begin_index-1)return t.data.fill(-1/0),t.data[this.timestamp_begin]=0,t;const n=e.slice(this.begin_index),s=n.length>=1&&n[n.length-1]>=this.timestamp_begin,i=n.length<2||n[n.length-2]>=this.timestamp_begin;if(s&&(i?t.data.subarray(this.timestamp_begin).fill(-1/0):t.data.subarray(0,this.eos_token_id).fill(-1/0)),e.length===this.begin_index&&null!==this.max_initial_timestamp_index){const e=this.timestamp_begin+this.max_initial_timestamp_index;t.data.subarray(e+1).fill(-1/0)}const o=(0,r.CI)(t.data);return Math.log(o.subarray(this.timestamp_begin).map(Math.exp).reduce(((e,t)=>e+t)))>(0,r.Fp)(o.subarray(0,this.timestamp_begin))[0]&&t.data.subarray(0,this.timestamp_begin).fill(-1/0),t}}class d extends o{constructor(e){super(),this.no_repeat_ngram_size=e}getNgrams(e){const t=e.length,n=[];for(let r=0;r<t+1-this.no_repeat_ngram_size;++r){const t=[];for(let n=0;n<this.no_repeat_ngram_size;++n)t.push(e[r+n]);n.push(t)}const s=new Map;for(const r of n){const e=r.slice(0,r.length-1),t=JSON.stringify(e),n=s.get(t)??[];n.push(r[r.length-1]),s.set(t,n)}return s}getGeneratedNgrams(e,t){const n=t.slice(t.length+1-this.no_repeat_ngram_size,t.length);return e.get(JSON.stringify(n))??[]}calcBannedNgramTokens(e){const t=[];if(e.length+1<this.no_repeat_ngram_size)return t;{const t=this.getNgrams(e);return this.getGeneratedNgrams(t,e)}}_call(e,t){const n=this.calcBannedNgramTokens(e);for(const s of n)t.data[s]=-1/0;return t}}class f extends o{constructor(e){super(),this.penalty=e}_call(e,t){for(const n of e)t.data[n]<0?t.data[n]*=this.penalty:t.data[n]/=this.penalty;return t}}class p extends o{constructor(e,t){super(),this.min_length=e,this.eos_token_id=Array.isArray(t)?t:[t]}_call(e,t){if(e.length<this.min_length)for(const n of this.eos_token_id)t.data[n]=-1/0;return t}}class _ extends o{constructor(e,t,n){super(),this.prompt_length_to_skip=e,this.min_new_tokens=t,this.eos_token_id=Array.isArray(n)?n:[n]}_call(e,t){if(e.length-this.prompt_length_to_skip<this.min_new_tokens)for(const n of this.eos_token_id)t.data[n]=-1/0;return t}}class g{constructor(e={}){this.max_length=e.max_length??20,this.max_new_tokens=e.max_new_tokens??null,this.min_length=e.min_length??0,this.min_new_tokens=e.min_new_tokens??null,this.early_stopping=e.early_stopping??!1,this.max_time=e.max_time??null,this.do_sample=e.do_sample??!1,this.num_beams=e.num_beams??1,this.num_beam_groups=e.num_beam_groups??1,this.penalty_alpha=e.penalty_alpha??null,this.use_cache=e.use_cache??!0,this.temperature=e.temperature??1,this.top_k=e.top_k??50,this.top_p=e.top_p??1,this.typical_p=e.typical_p??1,this.epsilon_cutoff=e.epsilon_cutoff??0,this.eta_cutoff=e.eta_cutoff??0,this.diversity_penalty=e.diversity_penalty??0,this.repetition_penalty=e.repetition_penalty??1,this.encoder_repetition_penalty=e.encoder_repetition_penalty??1,this.length_penalty=e.length_penalty??1,this.no_repeat_ngram_size=e.no_repeat_ngram_size??0,this.bad_words_ids=e.bad_words_ids??null,this.force_words_ids=e.force_words_ids??null,this.renormalize_logits=e.renormalize_logits??!1,this.constraints=e.constraints??null,this.forced_bos_token_id=e.forced_bos_token_id??null,this.forced_eos_token_id=e.forced_eos_token_id??null,this.remove_invalid_values=e.remove_invalid_values??!1,this.exponential_decay_length_penalty=e.exponential_decay_length_penalty??null,this.suppress_tokens=e.suppress_tokens??null,this.begin_suppress_tokens=e.begin_suppress_tokens??null,this.forced_decoder_ids=e.forced_decoder_ids??null,this.num_return_sequences=e.num_return_sequences??1,this.output_attentions=e.output_attentions??!1,this.output_hidden_states=e.output_hidden_states??!1,this.output_scores=e.output_scores??!1,this.return_dict_in_generate=e.return_dict_in_generate??!1,this.pad_token_id=e.pad_token_id??null,this.bos_token_id=e.bos_token_id??null,this.eos_token_id=e.eos_token_id??null,this.encoder_no_repeat_ngram_size=e.encoder_no_repeat_ngram_size??0,this.decoder_start_token_id=e.decoder_start_token_id??null,this.generation_kwargs=e.generation_kwargs??{}}}class m extends s.Ag{constructor(e){super(),this.generation_config=e}_call(e,t=-1){return this.sample(e,t)}sample(e,t){throw Error("sample should be implemented in subclasses.")}getLogits(e,t){let n=e.dims.at(-1),s=e.data;if(-1===t)s=s.slice(-n);else{let e=t*n;s=s.slice(e,e+n)}return this.generation_config.temperature>0&&(s=s.map((e=>e/this.generation_config.temperature))),s}randomSelect(e){let t=e.reduce(((e,t)=>e+t),0),n=Math.random()*t;for(let s=0;s<e.length;++s)if(n-=e[s],n<=0)return s;return 0}static getSampler(e){if(e.do_sample)return new y(e);if(e.num_beams>1)return new b(e);if(e.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${e.num_return_sequences}.`);return new w(e)}}class w extends m{sample(e,t=-1){let n=this.getLogits(e,t);return[[(0,r.Fp)(n)[1],0]]}}class y extends m{sample(e,t=-1){let n=e.dims.at(-1);this.generation_config.top_k>0&&(n=Math.min(this.generation_config.top_k,n));const s=this.getLogits(e,t),i=(0,r.em)(s,n),o=(0,r.XA)(i.map((e=>e[1])));return Array.from({length:this.generation_config.num_beams},(()=>{const e=this.randomSelect(o);return[i[e][0],Math.log(o[e])]}))}}class b extends m{sample(e,t=-1){let n=e.dims.at(-1);this.generation_config.top_k>0&&(n=Math.min(this.generation_config.top_k,n));const s=this.getLogits(e,t),i=(0,r.em)(s,n),o=(0,r.XA)(i.map((e=>e[1])));return Array.from({length:this.generation_config.num_beams},((e,t)=>[i[t][0],Math.log(o[t])]))}}},5261:function(e,t,n){"use strict";n.d(t,{hn:function(){return c},st:function(){return f},yM:function(){return p}});var s=n(7147),r=n(1418),i=n(319),o=n(8563),a=n(9346);globalThis.ReadableStream||(globalThis.ReadableStream=i.ReadableStream);class l{_CONTENT_TYPE_MAP={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};constructor(e){if(this.filePath=e,this.headers=new Headers,this.exists=s.existsSync(e),this.exists){this.status=200,this.statusText="OK";let t=s.statSync(e);this.headers.set("content-length",t.size.toString()),this.updateContentType();let n=this;this.body=new ReadableStream({start(e){n.arrayBuffer().then((t=>{e.enqueue(new Uint8Array(t)),e.close()}))}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){const e=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",this._CONTENT_TYPE_MAP[e]??"application/octet-stream")}clone(){let e=new l(this.filePath);return e.exists=this.exists,e.status=this.status,e.statusText=this.statusText,e.headers=new Headers(this.headers),e}async arrayBuffer(){return(await s.promises.readFile(this.filePath)).buffer}async blob(){const e=await s.promises.readFile(this.filePath);return new Blob([e],{type:this.headers.get("content-type")})}async text(){return await s.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function h(e,t=null){let n;try{n=new URL(e)}catch(s){return!1}return!(t&&!t.includes(n.hostname))&&("http:"===n.protocol||"https:"===n.protocol)}async function c(e){if(o.O.useFS&&!h(e))return new l(e);if("undefined"!=typeof process&&"node"===process?.release?.name){const t=!!{}?.TESTING_REMOTELY,n=o.O.version,s=new Headers;s.set("User-Agent",`transformers.js/${n}; is_ci/${t};`);if(h(e,["huggingface.co","hf.co"])){const e={}?.HF_ACCESS_TOKEN;e&&s.set("Authorization",`Bearer ${e}`)}return fetch(e,{headers:s})}return fetch(e)}const u={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};class d{constructor(e){this.path=e}async match(e){let t=r.join(this.path,e),n=new l(t);return n.exists?n:void 0}async put(e,t){const n=Buffer.from(await t.arrayBuffer());let i=r.join(this.path,e);try{await s.promises.mkdir(r.dirname(i),{recursive:!0}),await s.promises.writeFile(i,n)}catch(o){console.warn("An error occurred while writing the file to cache:",o)}}}async function f(e,t,n=!0,s={}){if(!o.O.allowLocalModels){if(s.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");if(!o.O.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}let r;if((0,a.T2)(s.progress_callback,{status:"initiate",name:e,file:t}),!r&&o.O.useBrowserCache){if("undefined"==typeof caches)throw Error("Browser cache is not available in this environment.");try{r=await caches.open("transformers-cache")}catch(x){console.warn("An error occurred while opening the browser cache:",x)}}if(!r&&o.O.useFSCache&&(r=new d(s.cache_dir??o.O.cacheDir)),!r&&o.O.useCustomCache){if(!o.O.customCache)throw Error("`env.useCustomCache=true`, but `env.customCache` is not defined.");if(!o.O.customCache.match||!o.O.customCache.put)throw new Error("`env.customCache` must be an object which implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache");r=o.O.customCache}const i=s.revision??"main";let l,f,p=_(e,t),g=_(o.O.localModelPath,p),m=_(o.O.remoteHost,o.O.remotePathTemplate.replaceAll("{model}",e).replaceAll("{revision}",i),t),w="main"===i?p:_(e,i,t),y=r instanceof d?w:m,b=!1;if(r&&(f=await async function(e,...t){for(let n of t)try{let t=await e.match(n);if(t)return t}catch(x){continue}}(r,g,y)),void 0===f){if(o.O.allowLocalModels){if(h(p)){if(s.local_files_only)throw new Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${p}.`);if(!o.O.allowRemoteModels)throw new Error(`\`env.allowRemoteModels=false\`, but attempted to load a remote file from: ${p}.`)}else try{f=await c(g),l=g}catch(x){console.warn(`Unable to load from local path "${g}": "${x}"`)}}if(void 0===f||404===f.status){if(s.local_files_only||!o.O.allowRemoteModels){if(n)throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${g}".`);return null}if(f=await c(m),200!==f.status)return function(e,t,n){if(!n)return null;const s=u[e]??`Error (${e}) occurred while trying to load file`;throw Error(`${s}: "${t}".`)}(f.status,m,n);l=y}b=r&&"undefined"!=typeof Response&&f instanceof Response&&200===f.status}(0,a.T2)(s.progress_callback,{status:"download",name:e,file:t});const k=await async function(e,t){const n=e.headers.get("Content-Length");null===n&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let s=parseInt(n??"0"),r=new Uint8Array(s),i=0;const o=e.body.getReader();async function a(){const{done:e,value:n}=await o.read();if(e)return;let l=i+n.length;if(l>s){s=l;let e=new Uint8Array(s);e.set(r),r=e}r.set(n,i),i=l;return t({progress:i/s*100,loaded:i,total:s}),a()}return await a(),r}(f,(n=>{(0,a.T2)(s.progress_callback,{status:"progress",...n,name:e,file:t})}));return b&&l&&void 0===await r.match(l)&&await r.put(l,new Response(k,{headers:f.headers})).catch((e=>{console.warn(`Unable to add response to browser cache: ${e}.`)})),(0,a.T2)(s.progress_callback,{status:"done",name:e,file:t}),k}async function p(e,t,n=!0,s={}){let r=await f(e,t,n,s);if(null===r)return{};let i=new TextDecoder("utf-8").decode(r);return JSON.parse(i)}function _(...e){return(e=e.map(((t,n)=>(n&&(t=t.replace(new RegExp("^/"),"")),n!==e.length-1&&(t=t.replace(new RegExp("/$"),"")),t)))).join("/")}},1912:function(e,t,n){"use strict";function s(e,[t,n,s],[r,i],o="bilinear",a=!1){const l=i/s,h=r/n,c=new e.constructor(r*i*t),u=n*s,d=r*i;for(let f=0;f<r;++f)for(let r=0;r<i;++r){const o=f*i+r,a=(r+.5)/l-.5,p=(f+.5)/h-.5;let _=Math.floor(a),g=Math.floor(p);const m=Math.min(_+1,s-1),w=Math.min(g+1,n-1);_=Math.max(_,0),g=Math.max(g,0);const y=a-_,b=p-g,k=(1-y)*(1-b),x=y*(1-b),v=(1-y)*b,A=y*b,z=g*s,E=w*s,T=z+_,M=z+m,C=E+_,I=E+m;for(let n=0;n<t;++n){const t=n*u;c[n*d+o]=k*e[t+T]+x*e[t+M]+v*e[t+C]+A*e[t+I]}}return c}function r(e,t,n){const s=new Array(n.length),r=new Array(n.length);for(let a=n.length-1,l=1;a>=0;--a)r[a]=l,s[a]=t[n[a]],l*=s[a];const i=n.map(((e,t)=>r[n.indexOf(t)])),o=new e.constructor(e.length);for(let a=0;a<e.length;++a){let n=0;for(let e=t.length-1,s=a;e>=0;--e)n+=s%t[e]*i[e],s=Math.floor(s/t[e]);o[n]=e[a]}return[o,s]}function i(e){const t=h(e)[0],n=e.map((e=>Math.exp(e-t))),s=n.reduce(((e,t)=>e+t),0);return n.map((e=>e/s))}function o(e){return i(e).map((e=>Math.log(e)))}function a(e,t=0){return e=Array.from(e).map(((e,t)=>[t,e])).sort(((e,t)=>t[1]-e[1])),t>0&&(e=e.slice(0,t)),e}function l(e){if(0===e.length)throw Error("Array must not be empty");let t=e[0],n=0;for(let s=1;s<e.length;++s)e[s]<t&&(t=e[s],n=s);return[t,n]}function h(e){if(0===e.length)throw Error("Array must not be empty");let t=e[0],n=0;for(let s=1;s<e.length;++s)e[s]>t&&(t=e[s],n=s);return[t,n]}function c(e,t=1){if(!Number.isInteger(e))throw new TypeError(`n should be an integer, but ${e} given.`);const n=1/(e*t),s=Math.floor(e/2)+1,r=new Array(s);for(let i=0;i<s;++i)r[i]=i*n;return r}n.d(t,{CI:function(){return o},Fp:function(){return h},K0:function(){return r},NM:function(){return f},Nq:function(){return s},VV:function(){return l},XA:function(){return i},bi:function(){return c},em:function(){return a},qC:function(){return d},vw:function(){return u}});class u{constructor(e){if(this.size=0|e,this.size<=1||0!=(this.size&this.size-1))throw new Error("FFT size must be a power of two and bigger than 1");this._csize=e<<1,this.table=new Float32Array(2*this.size);for(let n=0;n<this.table.length;n+=2){const e=Math.PI*n/this.size;this.table[n]=Math.cos(e),this.table[n+1]=-Math.sin(e)}let t=0;for(let n=1;this.size>n;n<<=1)++t;this._width=t%2==0?t-1:t,this._bitrev=new Int32Array(1<<this._width);for(let n=0;n<this._bitrev.length;++n){this._bitrev[n]=0;for(let e=0;e<this._width;e+=2){const t=this._width-e-2;this._bitrev[n]|=(n>>>e&3)<<t}}}createComplexArray(){return new Float32Array(this._csize)}fromComplexArray(e,t){const n=t||new Array(e.length>>>1);for(let s=0;s<e.length;s+=2)n[s>>>1]=e[s];return n}toComplexArray(e,t){const n=t||this.createComplexArray();for(let s=0;s<n.length;s+=2)n[s]=e[s>>>1],n[s+1]=0;return n}completeSpectrum(e){const t=this._csize,n=t>>>1;for(let s=2;s<n;s+=2)e[t-s]=e[s],e[t-s+1]=-e[s+1]}transform(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._transform4(e,t,1)}realTransform(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._realTransform4(e,t,1)}inverseTransform(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._transform4(e,t,-1);for(let n=0;n<e.length;++n)e[n]/=this.size}_transform4(e,t,n){const s=this._csize;let r,i,o=1<<this._width,a=s/o<<1,l=this._bitrev;if(4===a)for(r=0,i=0;r<s;r+=a,++i){const n=l[i];this._singleTransform2(t,e,r,n,o)}else for(r=0,i=0;r<s;r+=a,++i){const s=l[i];this._singleTransform4(t,e,r,s,o,n)}for(o>>=2;o>=2;o>>=2){a=s/o<<1;let t=a>>>2;for(r=0;r<s;r+=a){let s=r+t;for(let i=r,a=0;i<s;i+=2,a+=o){const s=i,r=s+t,o=r+t,l=o+t,h=e[s],c=e[s+1],u=e[r],d=e[r+1],f=e[o],p=e[o+1],_=e[l],g=e[l+1],m=this.table[a],w=n*this.table[a+1],y=u*m-d*w,b=u*w+d*m,k=this.table[2*a],x=n*this.table[2*a+1],v=f*k-p*x,A=f*x+p*k,z=this.table[3*a],E=n*this.table[3*a+1],T=_*z-g*E,M=_*E+g*z,C=h+v,I=c+A,S=h-v,F=c-A,R=y+T,O=b+M,j=n*(y-T),$=n*(b-M);e[s]=C+R,e[s+1]=I+O,e[r]=S+$,e[r+1]=F-j,e[o]=C-R,e[o+1]=I-O,e[l]=S-$,e[l+1]=F+j}}}}_singleTransform2(e,t,n,s,r){const i=e[s],o=e[s+1],a=e[s+r],l=e[s+r+1];t[n]=i+a,t[n+1]=o+l,t[n+2]=i-a,t[n+3]=o-l}_singleTransform4(e,t,n,s,r,i){const o=2*r,a=3*r,l=e[s],h=e[s+1],c=e[s+r],u=e[s+r+1],d=e[s+o],f=e[s+o+1],p=e[s+a],_=e[s+a+1],g=l+d,m=h+f,w=l-d,y=h-f,b=c+p,k=u+_,x=i*(c-p),v=i*(u-_);t[n]=g+b,t[n+1]=m+k,t[n+2]=w+v,t[n+3]=y-x,t[n+4]=g-b,t[n+5]=m-k,t[n+6]=w-v,t[n+7]=y+x}_realTransform4(e,t,n){const s=this._csize;let r=1<<this._width,i=s/r<<1;var o,a,l=this._bitrev;if(4===i)for(o=0,a=0;o<s;o+=i,++a){const n=l[a];this._singleRealTransform2(t,e,o,n>>>1,r>>>1)}else for(o=0,a=0;o<s;o+=i,++a){const s=l[a];this._singleRealTransform4(t,e,o,s>>>1,r>>>1,n)}for(r>>=2;r>=2;r>>=2){i=s/r<<1;const t=i>>>1,a=t>>>1,l=a>>>1;for(o=0;o<s;o+=i)for(let s=0,i=0;s<=l;s+=2,i+=r){const r=o+s,h=r+a,c=h+a,u=c+a,d=e[r],f=e[r+1],p=e[h],_=e[h+1],g=e[c],m=e[c+1],w=e[u],y=e[u+1],b=this.table[i],k=n*this.table[i+1],x=p*b-_*k,v=p*k+_*b,A=this.table[2*i],z=n*this.table[2*i+1],E=g*A-m*z,T=g*z+m*A,M=this.table[3*i],C=n*this.table[3*i+1],I=w*M-y*C,S=w*C+y*M,F=d+E,R=f+T,O=d-E,j=f-T,$=x+I,P=v+S,N=n*(x-I),B=n*(v-S);if(e[r]=F+$,e[r+1]=R+P,e[h]=O+B,e[h+1]=j-N,0===s){e[c]=F-$,e[c+1]=R-P;continue}if(s===l)continue;const U=o+a-s,L=o+t-s;e[U]=O+-n*B,e[U+1]=-j-n*N,e[L]=F+-n*$,e[L+1]=n*P-R}}}_singleRealTransform2(e,t,n,s,r){const i=e[s],o=e[s+r];t[n]=i+o,t[n+1]=0,t[n+2]=i-o,t[n+3]=0}_singleRealTransform4(e,t,n,s,r,i){const o=2*r,a=3*r,l=e[s],h=e[s+r],c=e[s+o],u=e[s+a],d=l+c,f=l-c,p=h+u,_=i*(h-u);t[n]=d+p,t[n+1]=0,t[n+2]=f,t[n+3]=-_,t[n+4]=d-p,t[n+5]=0,t[n+6]=f,t[n+7]=_}}function d(e,t){if(t%2==0||t<=0)throw new Error("Window size must be a positive odd number");const n=new e.constructor(e.length),s=new e.constructor(t),r=Math.floor(t/2);for(let i=0;i<e.length;++i){let t=0;for(let n=-r;n<=r;++n){let r=i+n;r<0?r=Math.abs(r):r>=e.length&&(r=2*(e.length-1)-r),s[t++]=e[r]}s.sort(),n[i]=s[r]}return n}function f(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}},4e3:function(e,t,n){"use strict";n.d(t,{J6:function(){return g},Ks:function(){return m},d3:function(){return f},es:function(){return o},f3:function(){return _},kn:function(){return p},p4:function(){return a},r6:function(){return w},sX:function(){return l},v6:function(){return h}});var s=n(1328),r=n(1912);const i=s.ONNX.Tensor;class o extends i{constructor(...e){return e[0]instanceof s.ONNX.Tensor?super(e[0].type,e[0].data,e[0].dims):super(...e),new Proxy(this,{get:(e,t)=>{if("string"==typeof t){let n=Number(t);if(Number.isInteger(n))return e._getitem(n)}return e[t]},set:(e,t,n)=>e[t]=n})}*[Symbol.iterator](){const[e,...t]=this.dims;if(t.length>0){const n=t.reduce(((e,t)=>e*t));for(let s=0;s<e;++s)yield this._subarray(s,n,t)}else yield*this.data}_getitem(e){const[t,...n]=this.dims;if(e=d(e,t),n.length>0){const t=n.reduce(((e,t)=>e*t));return this._subarray(e,t,n)}return new o(this.type,[this.data[e]],n)}indexOf(e){for(let t=0;t<this.data.length;++t)if(this.data[t]==e)return t;return-1}_subarray(e,t,n){let s=this.data.subarray(e*t,(e+1)*t);return new o(this.type,s,n)}item(){if(1!==this.data.length)throw new Error(`a Tensor with ${this.data.length} elements cannot be converted to Scalar`);return this.data[0]}tolist(){return function(e,t){const n=e.length,s=t.reduce(((e,t)=>e*t));if(n!==s)throw Error(`cannot reshape array of size ${n} into shape (${t})`);let r=e;for(let i=t.length-1;i>=0;i--)r=r.reduce(((e,n)=>{let s=e[e.length-1];return s.length<t[i]?s.push(n):e.push([n]),e}),[[]]);return r[0]}(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){for(let e=0;e<this.data.length;++e)this.data[e]=1/(1+Math.exp(-this.data[e]));return this}clone(){return new o(this.type,this.data.slice(),this.dims.slice())}slice(...e){let t=[],n=[];for(let o=0;o<this.dims.length;++o){let s=e[o];if(null==s)n.push([0,this.dims[o]]),t.push(this.dims[o]);else if("number"==typeof s)s=d(s,this.dims[o],o),n.push([s,s+1]);else{if(!Array.isArray(s)||2!==s.length)throw new Error(`Invalid slice: ${s}`);{if(s[0]>s[1])throw new Error(`Invalid slice: ${s}`);let e=[Math.max(s[0],0),Math.min(s[1],this.dims[o])];n.push(e),t.push(e[1]-e[0])}}}let s=n.map((([e,t])=>t-e)),r=s.reduce(((e,t)=>e*t)),i=new this.data.constructor(r);const a=this.stride();for(let o=0;o<r;++o){let e=0;for(let t=s.length-1,r=o;t>=0;--t){const i=s[t];e+=(r%i+n[t][0])*a[t],r=Math.floor(r/i)}i[o]=this.data[e]}return new o(this.type,i,t)}transpose(...e){return a(this,e)}sum(e=null,t=!1){return this.norm(1,e,t)}norm(e="fro",t=null,n=!1){if("fro"===e)e=2;else if("string"==typeof e)throw Error(`Unsupported norm: ${e}`);if(null===t){let t=this.data.reduce(((t,n)=>t+n**e),0)**(1/e);return new o(this.type,[t],[])}t=d(t,this.dims.length);const s=this.dims.slice();s[t]=1;const r=new this.data.constructor(this.data.length/this.dims[t]);for(let i=0;i<this.data.length;++i){let n=0;for(let e=this.dims.length-1,r=i,o=1;e>=0;--e){const i=this.dims[e];if(e!==t){n+=r%i*o,o*=s[e]}r=Math.floor(r/i)}r[n]+=this.data[i]**e}if(1!==e)for(let i=0;i<r.length;++i)r[i]=r[i]**(1/e);return n||s.splice(t,1),new o(this.type,r,s)}normalize_(e=2,t=1){t=d(t,this.dims.length);const n=this.norm(e,t,!0);for(let s=0;s<this.data.length;++s){let e=0;for(let n=this.dims.length-1,r=s,i=1;n>=0;--n){const s=this.dims[n];if(n!==t){e+=r%s*i,i*=this.dims[n]}r=Math.floor(r/s)}this.data[s]/=n.data[e]}return this}normalize(e=2,t=1){return this.clone().normalize_(e,t)}stride(){return function(e){const t=new Array(e.length);for(let n=e.length-1,s=1;n>=0;--n)t[n]=s,s*=e[n];return t}(this.dims)}squeeze(e=null){return new o(this.type,this.data,c(this.dims,e))}squeeze_(e=null){return this.dims=c(this.dims,e),this}unsqueeze(e=null){return new o(this.type,this.data,u(this.dims,e))}unsqueeze_(e=null){return this.dims=u(this.dims,e),this}flatten_(e=0,t=-1){t=(t+this.dims.length)%this.dims.length;let n=this.dims.slice(0,e),s=this.dims.slice(e,t+1),r=this.dims.slice(t+1);return this.dims=[...n,s.reduce(((e,t)=>e*t),1),...r],this}flatten(e=0,t=-1){return this.clone().flatten_(e,t)}view(...e){let t=-1;for(let n=0;n<e.length;++n)if(-1===e[n]){if(-1!==t)throw new Error("Only one dimension can be inferred");t=n}if(-1!==t){const n=e.reduce(((e,n,s)=>s!==t?e*n:e),1);e[t]=this.data.length/n}return new o(this.type,this.data,e)}neg_(){for(let e=0;e<this.data.length;++e)this.data[e]=-this.data[e];return this}neg(){return this.clone().neg_()}}function a(e,t){const[n,s]=(0,r.K0)(e.data,e.dims,t);return new o(e.type,n,s)}function l(e,[t,n],s="bilinear",i=!1){const a=e.dims.at(-3)??1,l=e.dims.at(-2),h=e.dims.at(-1);let c=(0,r.Nq)(e.data,[a,l,h],[t,n],s,i);return new o(e.type,c,[a,t,n])}function h(e,t){let n=[e.dims[0],e.dims[2]],s=new e.data.constructor(n[0]*n[1]),[r,i,a]=e.dims,l=0;for(let o=0;o<r;++o){let n=o*a*i;for(let r=0;r<a;++r){let h=0,c=0,u=o*i,d=n+r;for(let n=0;n<i;++n){let s=Number(t.data[u+n]);c+=s,h+=e.data[d+n*a]*s}let f=h/c;s[l++]=f}}return new o(e.type,s,n)}function c(e,t){return e=e.slice(),null===t?e=e.filter((e=>1!==e)):"number"==typeof t?1===e[t]&&e.splice(t,1):Array.isArray(t)&&(e=e.filter(((e,n)=>1!==e||!t.includes(n)))),e}function u(e,t){return t=d(t,e.length+1),(e=e.slice()).splice(t,0,1),e}function d(e,t,n=null){if(e<-t||e>=t)throw new Error(`IndexError: index ${e} is out of bounds for dimension${null===n?"":" "+n} with size ${t}`);return e<0&&(e=(e%t+t)%t),e}function f(e,t=0){t=d(t,e[0].dims.length);const n=e[0].dims.slice();n[t]=e.reduce(((e,n)=>e+n.dims[t]),0);const s=n.reduce(((e,t)=>e*t),1),r=new e[0].data.constructor(s),i=e[0].type;if(0===t){let t=0;for(let n of e)r.set(n.data,t),t+=n.data.length}else{let s=0;for(let i=0;i<e.length;++i){let o=e[i];for(let e=0;e<o.data.length;++e){let i=0;for(let r=o.dims.length-1,a=e,l=1;r>=0;--r){const e=o.dims[r];let h=a%e;r===t&&(h+=s),i+=h*l,l*=n[r],a=Math.floor(a/e)}r[i]=o.data[e]}s+=o.dims[t]}}return new o(i,r,n)}function p(e,t=0){return f(e.map((e=>e.unsqueeze(t))),t)}function _(e,t=null,n=1,s=!1){if(null===t){const t=e.data.reduce(((e,t)=>e+t),0)/e.data.length,s=Math.sqrt(e.data.reduce(((e,n)=>e+(n-t)**2),0)/(e.data.length-n)),r=new o(e.type,[t],[]);return[new o(e.type,[s],[]),r]}const r=g(e,t=d(t,e.dims.length),s),i=e.dims.slice();i[t]=1;const a=new e.data.constructor(e.data.length/e.dims[t]);for(let o=0;o<e.data.length;++o){let n=0;for(let s=e.dims.length-1,r=o,a=1;s>=0;--s){const o=e.dims[s];if(s!==t){n+=r%o*a,a*=i[s]}r=Math.floor(r/o)}a[n]+=(e.data[o]-r.data[n])**2}for(let o=0;o<a.length;++o)a[o]=Math.sqrt(a[o]/(e.dims[t]-n));s||i.splice(t,1);return[new o(e.type,a,i),r]}function g(e,t=null,n=!1){if(null===t){let t=e.data.reduce(((e,t)=>e+t),0);return new o(e.type,[t/e.data.length],[])}t=d(t,e.dims.length);const s=e.dims.slice();s[t]=1;const r=new e.data.constructor(e.data.length/e.dims[t]);for(let i=0;i<e.data.length;++i){let n=0;for(let r=e.dims.length-1,o=i,a=1;r>=0;--r){const i=e.dims[r];if(r!==t){n+=o%i*a,a*=s[r]}o=Math.floor(o/i)}r[n]+=e.data[i]}if(1!==e.dims[t])for(let i=0;i<r.length;++i)r[i]=r[i]/e.dims[t];return n||s.splice(t,1),new o(e.type,r,s)}function m(e){const[t,n]=e.dims,s=[t+1,n+1],r=new o("float32",new Float32Array(s[0]*s[1]).fill(1/0),s),i=new o("float32",new Float32Array(s[0]*s[1]).fill(-1),s);r[0].data[0]=0;for(let o=1;o<n+1;++o)for(let n=1;n<t+1;++n){const t=r[n-1][o-1].item(),s=r[n-1][o].item(),a=r[n][o-1].item();let l,h;t<s&&t<a?(l=t,h=0):s<t&&s<a?(l=s,h=1):(l=a,h=2),r[n].data[o]=e[n-1][o-1].item()+l,i[n].data[o]=h}let a=t,l=n;i.data.fill(2,0,s[1]);for(let o=0;o<s[0];++o)i[o].data[0]=1;let h=[],c=[];for(;a>0||l>0;){h.push(a-1),c.push(l-1);switch(i[a][l].item()){case 0:--a,--l;break;case 1:--a;break;case 2:--l;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${a}, ${l}]. Please file a bug report.`)}}return h.reverse(),c.reverse(),[h,c]}function w(e){return function(e){const t=e.reduce(((e,t)=>e*t),1);return new o("int64",new BigInt64Array(t).fill(1n),e)}(e.dims)}}},i={};function o(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return r[e](n,n.exports,o),n.exports}o.m=r,o.x=function(){var e=o.O(void 0,[2090,8770],(function(){return o(2798)}));return e=o.O(e)},e=[],o.O=function(t,n,s,r){if(!n){var i=1/0;for(c=0;c<e.length;c++){n=e[c][0],s=e[c][1],r=e[c][2];for(var a=!0,l=0;l<n.length;l++)(!1&r||i>=r)&&Object.keys(o.O).every((function(e){return o.O[e](n[l])}))?n.splice(l--,1):(a=!1,r<i&&(i=r));if(a){e.splice(c--,1);var h=s();void 0!==h&&(t=h)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[n,s,r]},n=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},o.t=function(e,s){if(1&s&&(e=this(e)),8&s)return e;if("object"==typeof e&&e){if(4&s&&e.__esModule)return e;if(16&s&&"function"==typeof e.then)return e}var r=Object.create(null);o.r(r);var i={};t=t||[null,n({}),n([]),n(n)];for(var a=2&s&&e;"object"==typeof a&&!~t.indexOf(a);a=n(a))Object.getOwnPropertyNames(a).forEach((function(t){i[t]=function(){return e[t]}}));return i.default=function(){return e},o.d(r,i),r},o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.f={},o.e=function(e){return Promise.all(Object.keys(o.f).reduce((function(t,n){return o.f[n](e,t),t}),[]))},o.u=function(e){return{2090:"79fd8960",8770:"e2fde11a"}[e]+"-"+{2090:"f0c0ffec0eaf6664a240",8770:"dfffc3e55f978ef2a5a5"}[e]+".js"},o.miniCssF=function(e){},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="/",function(){var e={7040:1};o.f.i=function(t,n){e[t]||importScripts(o.p+o.u(t))};var t=self.webpackChunkvad_var_site=self.webpackChunkvad_var_site||[],n=t.push.bind(t);t.push=function(t){var s=t[0],r=t[1],i=t[2];for(var a in r)o.o(r,a)&&(o.m[a]=r[a]);for(i&&i(o);s.length;)e[s.pop()]=1;n(t)}}(),s=o.x,o.x=function(){return Promise.all([o.e(2090),o.e(8770)]).then(s)};o.x()}();
//# sourceMappingURL=7040-99f45cc479dcfde18bd1.js.map