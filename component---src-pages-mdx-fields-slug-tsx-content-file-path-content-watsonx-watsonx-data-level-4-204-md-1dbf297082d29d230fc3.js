"use strict";(self.webpackChunkvad_var_site=self.webpackChunkvad_var_site||[]).push([[2688],{62486:function(e,t,n){n.r(t),n.d(t,{Head:function(){return p},default:function(){return b}});var a=n(11151),l=n(67294);function s(e){const t=Object.assign({section:"section",h1:"h1",p:"p",strong:"strong",a:"a",ol:"ol",li:"li",pre:"pre",code:"code",span:"span",h3:"h3",img:"img"},(0,a.ah)(),e.components),{QuizAlert:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("QuizAlert",!0),l.createElement(l.Fragment,null,l.createElement(n,{text:"Heads Up! Quiz material will be flagged like this!"}),"\n",l.createElement(t.section,{className:"heading","data-heading-rank":"1","aria-labelledby":"204-data-ingestion"},l.createElement(t.h1,{id:"204-data-ingestion"},"204: Data Ingestion"),"\n",l.createElement(t.p,null,"Data ingestion is the process of importing and loading data into IBM® watsonx.data. One\napproach is to use the Ingestion jobs tab from the Data manager page to load data securely and\neasily into watsonx.data console (",l.createElement(t.strong,null,"NOTE"),": This is only available in Standard Edition). Data\ningestion in watsonx.data console or in the ibm-lh command line utility supports CSV and\nParquet formats. The files that are ingested in a single ingestion command must be of the same\nformat type and schema. watsonx.data auto discovers the schema based on the source file\nbeing ingested."),"\n",l.createElement(t.p,null,"You can also load or ingest local data files or ingest data from external sources using the ibm-lh\ntool. The ibm-lh command-line utility is a terminal-based interface that is designed to facilitate\ninteraction with watsonx.data resources."),"\n",l.createElement(t.p,null,"This lab uses the ingest tool (ibm-lh) alongside the IBM watsonx.data Developer Edition that is\nrunning in this lab. The Ingest tool is a separate install and currently needs to be downloaded\nafter IBM watsonx.data is started. The lab image (Developer Edition) contains a copy of this code\nso you will not need to download it."),"\n",l.createElement(t.p,null,"In this section you will connect to your watsonx.data environment. The watsonx.data server\nautomatically starts all services. To check the status of the server, run the following commands\nusing the instructions provided in ",l.createElement(t.strong,null,"Command Line Access")," of the ",l.createElement(t.a,{href:"/watsonx/watsonxdata/1#command-line-access"},"1: Environment Setup"),":"),"\n",l.createElement(t.ol,null,"\n",l.createElement(t.li,null,"Open a terminal window and enter the following command to connect to the watsonx.data\nserver."),"\n"),"\n",l.createElement(t.p,null,l.createElement(t.strong,null,"Note:")," Replace the port, region, and techzone-server in the SSH command below with the\nvalues provided for your environment in the TechZone reservation email."),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},"ssh -p port watsonx@region.techzone-server.com\n")),"\n",l.createElement(t.ol,{start:"2"},"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,"Enter a password of: ",l.createElement(t.strong,null,"watsonx.data")),"\n"),"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,"Switch to the root user by entering the following command:"),"\n"),"\n"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},"sudo su - \n")),"\n",l.createElement(t.ol,{start:"4"},"\n",l.createElement(t.li,null,"Switch to the client bin directory by entering the following command:"),"\n"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},l.createElement(t.span,{className:"hljs-built_in"},"cd")," /root/ibm-lh-client/bin\n")),"\n",l.createElement(t.section,{className:"heading","data-heading-rank":"3","aria-labelledby":"ingest-data-into-ibm-watsonxdata"},l.createElement(t.h3,{id:"ingest-data-into-ibm-watsonxdata"},l.createElement(t.a,{href:"#ingest-data-into-ibm-watsonxdata"},"Ingest data into IBM watsonx.data")),"\n",l.createElement(t.p,null,"Before running the utility, you need to retrieve several credentials for MinIO and the keystore\npassword."),"\n",l.createElement(t.ol,null,"\n",l.createElement(t.li,null,"While still in the /root/ibm-lh-dev/bin directory, enter following commands to extract the\ncredentials. You need to generate three export lines and create a directory that will be used\nlater in another script."),"\n"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},l.createElement(t.span,{className:"hljs-built_in"},"export")," LH_S3_ACCESS_KEY=$(docker ",l.createElement(t.span,{className:"hljs-built_in"},"exec")," ibm-lh-presto \\\n",l.createElement(t.span,{className:"hljs-built_in"},"printenv")," | grep LH_S3_ACCESS_KEY | sed ",l.createElement(t.span,{className:"hljs-string"},"'s/.*=//'"),")\n")),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},l.createElement(t.span,{className:"hljs-built_in"},"export")," LH_S3_SECRET_KEY=$(docker ",l.createElement(t.span,{className:"hljs-built_in"},"exec")," ibm-lh-presto \\\n",l.createElement(t.span,{className:"hljs-built_in"},"printenv")," | grep LH_S3_SECRET_KEY | sed ",l.createElement(t.span,{className:"hljs-string"},"'s/.*=//'"),")\n")),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},l.createElement(t.span,{className:"hljs-built_in"},"export")," LH_KEYSTORE_PASSWORD=$(docker ",l.createElement(t.span,{className:"hljs-built_in"},"exec")," ibm-lh-presto \\\n",l.createElement(t.span,{className:"hljs-built_in"},"printenv")," | grep LH_KEYSTORE_PASSWORD | sed ",l.createElement(t.span,{className:"hljs-string"},"'s/.*=//'"),")\n")),"\n",l.createElement(t.ol,{start:"2"},"\n",l.createElement(t.li,null,"Run the following commands to create the staging directory. The staging directory is used to\nmove files between this system and the docker container where the ",l.createElement(t.strong,null,"ibm-lh command-line\nutility")," is running."),"\n"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},l.createElement(t.span,{className:"hljs-built_in"},"export")," staging=/root/ibm-lh-client/localstorage/volumes/infra/staging\n")),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},l.createElement(t.span,{className:"hljs-built_in"},"mkdir")," -p ",l.createElement(t.span,{className:"hljs-variable"},"${staging}"),"\n",l.createElement(t.span,{className:"hljs-built_in"},"cat")," <<",l.createElement(t.span,{className:"hljs-string"},"EOF > ${staging}/keys.sh\n#!/bin/bash\nexport access_key=$LH_S3_ACCESS_KEY\nexport secret_key=$LH_S3_SECRET_KEY\nexport keystore_password=$LH_KEYSTORE_PASSWORD\nEOF"),"\n",l.createElement(t.span,{className:"hljs-built_in"},"chmod")," +x ",l.createElement(t.span,{className:"hljs-variable"},"${staging}"),"/keys.sh\n")),"\n",l.createElement(t.ol,{start:"3"},"\n",l.createElement(t.li,null,"Run the following commands to copy the MinIO SSL certificate from the docker container to\nstaging directory. The MinIO SSL certificate is needed for copying operation to take place. In\naddition, the file that you want loaded into watsonx.data will be moved into the staging file\ndirectory."),"\n"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},"docker ",l.createElement(t.span,{className:"hljs-built_in"},"cp")," ibm-lh-presto:/mnt/infra/tls/lh-ssl-ts.jks \\\n",l.createElement(t.span,{className:"hljs-variable"},"${staging}"),"/lh-ssl-ts.jks\n",l.createElement(t.span,{className:"hljs-built_in"},"cp")," -f /sampledata/yellow_tripdata_2022-01.parquet \\\n",l.createElement(t.span,{className:"hljs-variable"},"${staging}"),"/\n")),"\n"),l.createElement(t.section,{className:"heading","data-heading-rank":"3","aria-labelledby":"create-a-hive-schema-for-staging-the-ingest-file"},l.createElement(t.h3,{id:"create-a-hive-schema-for-staging-the-ingest-file"},l.createElement(t.a,{href:"#create-a-hive-schema-for-staging-the-ingest-file"},"Create a hive schema for staging the ingest file")),"\n",l.createElement(t.p,null,"Before ingesting the file, you need to create a new schema for the table you are creating and\nloading. You will create the schema using the watsonx.data user interface. Your TechZone\nreservation email will include the URL of your watsonx.data user interface."),"\n",l.createElement(t.ol,null,"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,"Log in to the IBM watsonx.data console:\nThe URL to the watsonx.data console can be found in your TechZone reservation email\ndetails (see the ",l.createElement(t.strong,null,"Watsonx UI")," line in the Published services section)."),"\n",l.createElement(t.p,null,l.createElement(t.strong,null,"•")," Enter ",l.createElement(t.strong,null,"ibmlhadmin")," in the ",l.createElement(t.strong,null,"Username")," field."),"\n",l.createElement(t.p,null,l.createElement(t.strong,null,"•")," Enter ",l.createElement(t.strong,null,"password")," in the ",l.createElement(t.strong,null,"Password")," field."),"\n",l.createElement(t.p,null,l.createElement(t.strong,null,"•")," Click the ",l.createElement(t.strong,null,"Log in")," button."),"\n",l.createElement(t.img,{src:"https://raw.githubusercontent.com/ibm-build-lab/VAD-VAR-Workshop/main/content//Watsonx/WatsonxData/images/204/login-page.png",alt:""}),"\n"),"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,"Click the ",l.createElement(t.strong,null,"Data manager")," icon from the left-side menu.\n",l.createElement(t.img,{src:"https://raw.githubusercontent.com/ibm-build-lab/VAD-VAR-Workshop/main/content//Watsonx/WatsonxData/images/204/data-manager.png",alt:""})),"\n"),"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,"Click the ",l.createElement(t.strong,null,"Create")," dropdown menu and select ",l.createElement(t.strong,null,"Create schema"),".\n",l.createElement(t.img,{src:"https://raw.githubusercontent.com/ibm-build-lab/VAD-VAR-Workshop/main/content//Watsonx/WatsonxData/images/204/create-schema.png",alt:""})),"\n"),"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,"In the Create schema dialog, perform the following steps:"),"\n",l.createElement(t.p,null,l.createElement(t.strong,null,"•")," Click the ",l.createElement(t.strong,null,"Catalog")," dropdown menu and select ",l.createElement(t.strong,null,"hive_data"),"."),"\n",l.createElement(t.p,null,l.createElement(t.strong,null,"•")," Enter ",l.createElement(t.strong,null,"staging")," in the ",l.createElement(t.strong,null,"Name")," field."),"\n",l.createElement(t.p,null,l.createElement(t.strong,null,"•")," Click the blue ",l.createElement(t.strong,null,"Create")," button.\n",l.createElement(t.img,{src:"https://raw.githubusercontent.com/ibm-build-lab/VAD-VAR-Workshop/main/content//Watsonx/WatsonxData/images/204/hive-data.png",alt:""})),"\n"),"\n"),"\n",l.createElement(t.p,null,"You should see the new ",l.createElement(t.strong,null,"staging")," schema under ",l.createElement(t.strong,null,"hive_data")," catalog in the ",l.createElement(t.strong,null,"Catalogs associated"),"\nsection."),"\n",l.createElement(t.ol,{start:"5"},"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,"Repeat step 3 to create another schema. In the ",l.createElement(t.strong,null,"Create schema")," dialog, perform the following\nsteps:"),"\n",l.createElement(t.p,null,"• Click the ",l.createElement(t.strong,null,"Catalog")," dropdown menu and select ",l.createElement(t.strong,null,"iceberg_data"),"."),"\n",l.createElement(t.p,null,"• Enter ",l.createElement(t.strong,null,"ingest")," in the ",l.createElement(t.strong,null,"Name")," field."),"\n",l.createElement(t.p,null,"• Click the blue ",l.createElement(t.strong,null,"Create")," button.\n",l.createElement(t.img,{src:"https://raw.githubusercontent.com/ibm-build-lab/VAD-VAR-Workshop/main/content//Watsonx/WatsonxData/images/204/iceberg-data.png",alt:""})),"\n"),"\n"),"\n"),l.createElement(t.section,{className:"heading","data-heading-rank":"3","aria-labelledby":"ingest-using-ibm-lh-command-line-utility"},l.createElement(t.h3,{id:"ingest-using-ibm-lh-command-line-utility"},l.createElement(t.a,{href:"#ingest-using-ibm-lh-command-line-utility"},"Ingest using ibm-lh command-line utility")),"\n",l.createElement(t.p,null,"You will use the ibm-lh command line utility to ingest data. You will leave the watsonx.data UI\nfor now to do the next steps in the command line window."),"\n",l.createElement(t.ol,null,"\n",l.createElement(t.li,null,"To access the ibm-lh command line utility, enter the following command:"),"\n"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},"./ibm-lh data-copy\n")),"\n",l.createElement(t.ol,{start:"2"},"\n",l.createElement(t.li,null,"Once inside the utility, run the following command to get more details on the ",l.createElement(t.strong,null,"data-copy"),"\noption."),"\n"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},"ibm-lh data-copy --",l.createElement(t.span,{className:"hljs-built_in"},"help"),"\n")),"\n",l.createElement(t.ol,{start:"3"},"\n",l.createElement(t.li,null,"Run the following command to exit the tools container."),"\n"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},l.createElement(t.span,{className:"hljs-built_in"},"exit"),"\n")),"\n",l.createElement(t.ol,{start:"4"},"\n",l.createElement(t.li,null,"Run the following script to ingest the taxi data (yellow_tripdata_2022_01.parquet) into the\nyellow_tripdata_2022_01_localfile table in watsonx.data."),"\n"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},l.createElement(t.span,{className:"hljs-built_in"},"cat")," <<",l.createElement(t.span,{className:"hljs-string"},'EOF > ${staging}/ingest-local.sh\n#!/bin/bash\ndir=/mnt/infra/staging\ncd \\${dir}\nsource ./keys.sh\ntable_name="iceberg_data.ingest.yellow_tripdata_2022_01_localfile"\nfile="yellow_tripdata_2022-01.parquet"\nexport STAGING_S3_CREDS="AWS_SECRET_ACCESS_KEY=\\${secret_key}\\\\\n,AWS_ACCESS_KEY_ID=\\${access_key}\\\\\n,AWS_REGION=us-east-1\\\\\n,BUCKET_NAME=iceberg-bucket\\\\\n,ENDPOINT_URL=http://ibm-lh-minio:9000"\nibm-lh data-copy \\\\\n --source-data-files \\${dir}/\\${file} \\\\\n --target-tables \\${table_name} \\\\\n --ingestion-engine-endpoint "hostname=ibm-lh-presto-svc,port=8443" \\\\\n --staging-location s3://iceberg-bucket/ingest/ \\\\\n --staging-hive-catalog hive_data \\\\\n --staging-hive-schema staging \\\\\n --create-if-not-exist \\\\\n --trust-store-path \\${dir}/lh-ssl-ts.jks \\\\\n --trust-store-password \\${keystore_password} \\\\\n --dbuser ibmlhadmin \\\\\n --dbpassword password\nEOF'),"\n")),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},"sed -i ",l.createElement(t.span,{className:"hljs-string"},"'/^$/d'")," ",l.createElement(t.span,{className:"hljs-variable"},"${staging}"),"/ingest-local.sh\n")),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},l.createElement(t.span,{className:"hljs-built_in"},"chmod")," +x ",l.createElement(t.span,{className:"hljs-variable"},"${staging}"),"/ingest-local.sh\n")),"\n",l.createElement(t.ol,{start:"5"},"\n",l.createElement(t.li,null,"Run the following command to start the ibm-lh command line utility again:"),"\n"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},"./ibm-lh data-copy \n")),"\n",l.createElement(t.ol,{start:"6"},"\n",l.createElement(t.li,null,"Now run the ingest job inside the tool container by executing the following command:"),"\n"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},"/mnt/infra/staging/ingest-local.sh\n")),"\n",l.createElement(t.ol,{start:"7"},"\n",l.createElement(t.li,null,"After ingesting the data, exit the command line utility."),"\n"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"hljs language-bash"},l.createElement(t.span,{className:"hljs-built_in"},"exit"),"\n")),"\n",l.createElement(t.ol,{start:"8"},"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,"Go back to the IBM watsonx.data UI. From the ",l.createElement(t.strong,null,"Data manager")," section, Expand the\n",l.createElement(t.strong,null,"iceberg_data")," catalog in the ",l.createElement(t.strong,null,"Catalogs associated")," area and then expand the ",l.createElement(t.strong,null,"ingest")," schema.\n",l.createElement(t.img,{src:"https://raw.githubusercontent.com/ibm-build-lab/VAD-VAR-Workshop/main/content//Watsonx/WatsonxData/images/204/ingest.png",alt:""})),"\n"),"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,"Select the ",l.createElement(t.strong,null,"yellow_tripdata_2021_01_localfile")," table to see the table definition. Select the\n",l.createElement(t.strong,null,"Table schema")," tab to view the table schema if not already selected.\n",l.createElement(t.img,{src:"https://raw.githubusercontent.com/ibm-build-lab/VAD-VAR-Workshop/main/content//Watsonx/WatsonxData/images/204/table-schema.png",alt:""})),"\n"),"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,"Select the ",l.createElement(t.strong,null,"Data sample")," tab to see a sample of the data.\n",l.createElement(t.img,{src:"https://raw.githubusercontent.com/ibm-build-lab/VAD-VAR-Workshop/main/content//Watsonx/WatsonxData/images/204/data-sample.png",alt:""})),"\n"),"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,"Now you can use the UI to run a query against this imported data. Select the\n",l.createElement(t.strong,null,"Query workspace (SQL)")," icon from the left side menu.\n",l.createElement(t.img,{src:"https://raw.githubusercontent.com/ibm-build-lab/VAD-VAR-Workshop/main/content//Watsonx/WatsonxData/images/204/sql-workspace.png",alt:""})),"\n"),"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,"On the line where the ",l.createElement(t.strong,null,"yellow_tripdata_2022_01_localfile")," table is located, click the\n",l.createElement(t.strong,null,"Query templates")," icon at the end of the name. This will display a drop-down list. Select\n",l.createElement(t.strong,null,"Generate SELECT"),"\n",l.createElement(t.img,{src:"https://raw.githubusercontent.com/ibm-build-lab/VAD-VAR-Workshop/main/content//Watsonx/WatsonxData/images/204/generate-select.png",alt:""})),"\n"),"\n"),"\n",l.createElement(t.p,null,"This generates SQL SELECT statement in the window to the right of the table name.\n",l.createElement(t.img,{src:"https://raw.githubusercontent.com/ibm-build-lab/VAD-VAR-Workshop/main/content//Watsonx/WatsonxData/images/204/select-statement.png",alt:""})),"\n",l.createElement(t.p,null,"13.In order to review the results, execute the query by clicking on the blue\n",l.createElement(t.strong,null,"Run on presto-01 button"),".\n",l.createElement(t.img,{src:"https://raw.githubusercontent.com/ibm-build-lab/VAD-VAR-Workshop/main/content//Watsonx/WatsonxData/images/204/run-on-presto.png",alt:""})),"\n"),l.createElement(t.section,{className:"heading","data-heading-rank":"3","aria-labelledby":"summary"},l.createElement(t.h3,{id:"summary"},l.createElement(t.a,{href:"#summary"},"Summary")),"\n",l.createElement(t.p,null,"You have now completed the lab!\nIn this lab you ingested data by using the watsonx.data ibm-lh command-line utility and ran\na SQL statement to query the data that was ingested."),"\n"),l.createElement(t.section,{className:"heading","data-heading-rank":"3","aria-labelledby":"congratulations-youve-reached-the-end-of-lab-204"},l.createElement(t.h3,{id:"congratulations-youve-reached-the-end-of-lab-204"},l.createElement(t.a,{href:"#congratulations-youve-reached-the-end-of-lab-204"},"Congratulations, you've reached the end of lab 204.")),"\n",l.createElement(t.p,null,"If you would like to take the quiz covering the L4 hands on labs, it can be found ",l.createElement(t.a,{href:"https://learn.ibm.com/course/view.php?id=16013"},"here")))))}var r=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,a.ah)(),e.components);return t?l.createElement(t,e,l.createElement(s,e)):s(e)};var i=n(94184),o=n.n(i),c=n(24690),m=n(81140),h=n(48623),u=n(88531),g=n(13383),d=n(27315);const E=e=>{const{data:{mdx:{tableOfContents:{items:t},frontmatter:{toc:n=!0,title:a,timeToComplete:s,updated:r}}},children:i}=e,c=(0,l.useRef)(null),{0:E}=(0,l.useState)(""),p=(null===n||n)&&t;return l.createElement(l.Fragment,null,l.createElement(m.Z,{timeToComplete:s,updated:r},t[0].title||a||""),l.createElement(u.Z,{className:d.YS},l.createElement("article",{className:o()(d.Y2,!p&&d.ey),ref:c},l.createElement(h.Z,{components:{h1:()=>null}},i)),p&&l.createElement(g.Z,{itemsList:t,maxDepth:2,currSection:E})))},p=e=>{const{location:{pathname:t},data:{mdx:{frontmatter:{title:n},tableOfContents:{items:a}}}}=e;return l.createElement(c.Z,{pathname:t,title:n||a[0].title||void 0})};function b(e){return l.createElement(E,e,l.createElement(r,e))}}}]);
//# sourceMappingURL=component---src-pages-mdx-fields-slug-tsx-content-file-path-content-watsonx-watsonx-data-level-4-204-md-1dbf297082d29d230fc3.js.map